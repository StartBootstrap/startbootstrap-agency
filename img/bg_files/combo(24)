YUI.add("hermes-template-photo-note-read-mode",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return'<a href="/account/upgrade/pro" class="pro-badge-inline">PRO</a>'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'<div class="note-text" style="z-index:'+l((o=(o=n.z||(t!=null?t.z:t))!=null?o:a,typeof o===f?o.call(u,{name:"z",hash:{},data:i}):o))+';">\n	<div class="text-alignment-fix hyphenate" style="left:'+l((o=(o=n.x||(t!=null?t.x:t))!=null?o:a,typeof o===f?o.call(u,{name:"x",hash:{},data:i}):o))+"px;top:"+l((o=(o=n.y||(t!=null?t.y:t))!=null?o:a,typeof o===f?o.call(u,{name:"y",hash:{},data:i}):o))+'px">\n		<a href="'+l((o=(o=n.authorURL||(t!=null?t.authorURL:t))!=null?o:a,typeof o===f?o.call(u,{name:"authorURL",hash:{},data:i}):o))+'" class="author">'+l((o=(o=n.authorName||(t!=null?t.authorName:t))!=null?o:a,typeof o===f?o.call(u,{name:"authorName",hash:{},data:i}):o))+"</a>"+((s=n["if"].call(u,t!=null?t.authorIsPro:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+"<br>\n		"+l((n.renderTrustedMarkup||t&&t.renderTrustedMarkup||a).call(u,t!=null?t.text:t,{name:"renderTrustedMarkup",hash:{},data:i}))+"\n	</div>\n</div>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-note-read-mode",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-note-write-mode",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return'<button class="delete-note danger tiny">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.DELETE"},data:i}))+"</button>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'<div class="note-text adding" data-for-note-yuid="'+l((o=(o=n.noteYUID||(t!=null?t.noteYUID:t))!=null?o:a,typeof o===f?o.call(u,{name:"noteYUID",hash:{},data:i}):o))+'" style="z-index:'+l((o=(o=n.z||(t!=null?t.z:t))!=null?o:a,typeof o===f?o.call(u,{name:"z",hash:{},data:i}):o))+';">\n	<div class="text-alignment-fix hyphenate" style="left:'+l((o=(o=n.x||(t!=null?t.x:t))!=null?o:a,typeof o===f?o.call(u,{name:"x",hash:{},data:i}):o))+"px;top:"+l((o=(o=n.y||(t!=null?t.y:t))!=null?o:a,typeof o===f?o.call(u,{name:"y",hash:{},data:i}):o))+'px">\n		<textarea class="note-text-textarea" placeholder="'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_A_NOTE"},data:i}))+'">'+l((o=(o=n.text||(t!=null?t.text:t))!=null?o:a,typeof o===f?o.call(u,{name:"text",hash:{},data:i}):o))+'</textarea>\n		<div class="note-text-buttons">\n			<button class="save-note tiny">'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.SAVE"},data:i}))+'</button>\n			<button class="cancel-note alt tiny">'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.CANCEL"},data:i}))+"</button>"+((s=n["if"].call(u,t!=null?t.canDelete:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n		</div>\n	</div>\n</div>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-note-write-mode",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-note-drag-handles",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){return'<span class="note-drag-handle note-drag-handle-tl" data-drag-resize-direction="tl"></span><span class="note-drag-handle note-drag-handle-tr" data-drag-resize-direction="tr"></span><span class="note-drag-handle note-drag-handle-br" data-drag-resize-direction="br"></span><span class="note-drag-handle note-drag-handle-bl" data-drag-resize-direction="bl"></span>'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-note-drag-handles",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-notes-scrappy-view",function(e,t){function n(t){this.yuid=e.guid(),this.id=t.id,this.photoId=t.photoId,this.x=t.x,this.y=t.y,this.z=0,this.w=t.w,this.h=t.h,this.text=t.text,this.author=t.author,this.authorName=t.authorName,this.authorRealName=t.authorRealName,this.authorIsPro=t.authorIsPro,this.canEdit=t.canEdit,this.canDelete=t.canDelete,this.isStoredOnServer=t.isStoredOnServer}n.prototype.getScaled=function(e){return{x:this.x*e,y:this.y*e,w:this.w*e,h:this.h*e}};var r=20,i=1e3,s=1,o=100,u=2,a=8,f={idle:{begin:"beginIdle",end:"endIdle",events:{mousedown:"handleIdleMouseDown",mouseup:"handleIdleMouseUp",mouseenter:{handler:"handleIdleMouseEnter",delegate:".note"},mouseleave:{handler:"handleIdleMouseLeave",delegate:".note"}}},editing:{begin:"beginEditing",events:{mousedown:"handleEditingMouseDown",mouseup:"handleEditingMouseUp",keydown:"handleEditingKeyDown"}},dragging:{begin:"beginDragging",end:"endDragging",events:{mousemove:"handleDraggingMouseMove",mouseup:"handleDraggingMouseUp"}}};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.stateEventHandles=[],this},loadState:function(){var t=this,n;return n={photo:this.appContext.getModel("photo-models",this._params.photoId),photoNotes:this.appContext.getModel("photo-notes-models",this._params.photoId),noteModel:this.appContext.getModelRegistry("note-models")},this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid&&(n.viewer=this.appContext.getModel("person-models",this.appContext.getViewer().nsid)),(new e.FlickrPromise(n)).then(function(e){t.set("photoModel",e.photo),t.set("photoNotesModel",e.photoNotes),t.set("noteModel",e.noteModel),e.viewer&&t.set("viewer",e.viewer)})},buildContainer:function(){return this},activate:function(){var t=this.appContext.flipper.isFlipped("enable-scrappy-notes-deleting"),r=this.appContext.flipper.isFlipped("enable-scrappy-notes-editing"),s=this.get("photoModel"),o=s.getValue("owner"),u=o.getValue("id"),a=this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid,f=this.get("photoNotesModel"),l=f.getValue("notes").toJSON(),c,h,p,d;if(s.getValue("isVideo"))return this.deactivate(),this;this.box=this.get("container"),this.notes=[],this.canAddNotes=s.getValue("canAddMeta"),this.canAddNotes&&this.box.setStyle("pointerEvents","auto"),this.registerEventHandler(this.box.on("mouseenter",this.revealNotes.bind(this))),this.registerEventHandler(this.box.on("mouseleave",this.hideNotes.bind(this))),this.registerEventHandler(e.on("photo:entering-vr",this.deactivate.bind(this)));for(h=0;h<l.length;h++)c=l[h],p=r&&(a===u||a===c.author),d=t&&(a===u||a===c.author),this.notes.push(new n({id:c.id,photoId:s.getValue("id"),x:c.left,y:c.top,w:c.width,h:c.height,text:c.text,author:c.author,authorName:c.authorName,authorRealName:c.authorRealName,authorIsPro:c.authorIsPro,canEdit:p,canDelete:d,isStoredOnServer:!0}));return this.restackNotes(),this.syncWithPhoto(),this.renderNotes(),this.revealNotes(),this.pageLoadNotesFlashTimer=setTimeout(this.hideNotes.bind(this),i),this.enterState("idle"),this},onParentViewEvent:function(e,t){t&&t[0]==="photoWellResized"&&this.isActivated&&this.box&&(this.syncWithPhoto(),this.renderNotes())},enterState:function(e,t){var n;t=t||{};if(!f[e])return;while(this.stateEventHandles.length)this.stateEventHandles.pop().detach();this.currentState&&f[this.currentState].end&&this[f[this.currentState].end]&&this[f[this.currentState].end].call(this,t);for(var r in f[e].events)n=f[e].events[r],typeof n=="string"?this.stateEventHandles.push(this.box.on(r,this[n].bind(this))):typeof n=="object"&&(n.delegate?this.stateEventHandles.push(this.box.delegate(r,this[n.handler].bind(this),n.delegate)):this.stateEventHandles.push(this.box.on(r,this[n.handler].bind(this))));f[e].begin&&this[f[e].begin]&&this[f[e].begin].call(this,t),this.currentState=e},revealNotes:function(e){this.box.addClass("box-hovered"),clearTimeout(this.pageLoadNotesFlashTimer)},hideNotes:function(){this.box.removeClass("box-hovered"),this.hideHovered()},beginIdle:function(e){var t=e.element;this.box.removeClass("box-note-clicked"),delete this.draggingMemo,this.box.all(".note-text").remove(!0),t&&t.getDOMNode()&&t.removeClass("note-clicked"),e.rerender&&(this.restackNotes(),this.renderNotes())},endIdle:function(e){this.tempMouseMoveListener&&(this.tempMouseMoveListener.detach(),delete this.tempMouseMoveListener)},handleIdleMouseDown:function(t){var i,s,o,u,f=!1;if(t.button!==1||t.ctrlKey||t.metaKey)return;if(t.target.hasClass("note-text"))return;t.target.hasClass("note")&&(i=this.getNoteByID(t.target.getAttribute("data-note-yuid"))),i&&(i.canEdit||i.canDelete)?this.enterState("editing",{note:i,element:t.target}):(o={x:t.clientX,y:t.clientY},u=this.box.getXY(),this.canAddNotes&&(t.preventDefault(),this.tempMouseMoveListener=this.box.on("mousemove",function(t){var i,l,c,h,p;i=Math.sqrt(Math.pow(t.clientX-o.x,2)+Math.pow(t.clientY-o.y,2)),l="";if(i<r)return;f||(f=!0,this.box.addClass("doing-initial-drag")),l+=o.y-t.clientY>=0?"t":"b",l+=o.x-t.clientX>=0?"l":"r";switch(l){case"tl":h=0,p=0;break;case"tr":h=a,p=0;break;case"bl":h=0,p=a;break;case"br":h=a,p=a}c=this.get("viewer"),s=new n({id:e.guid(),photoId:this.get("photoModel").getValue("id"),x:(Math.min(o.x,t.clientX)-u[0]+window.pageXOffset)/this.ratio,y:(Math.min(o.y,t.clientY)-u[1]+window.pageYOffset)/this.ratio,w:Math.abs(o.x-t.clientX)/this.ratio-h,h:Math.abs(o.y-t.clientY)/this.ratio-p,text:"",author:c.getValue("nsid"),authorName:c.getValue("username"),authorRealName:c.getValue("displayname"),authorIsPro:c.getValue("isPro"),canEdit:!0,canDelete:!0,isStoredOnServer:!1}),this.notes.push(s),this.createNewNote(s),this.storeNoteBackup(s),s.node.append(this.templates("photo-note-drag-handles")()),this.box.addClass("box-note-clicked"),s.node.addClass("note-clicked"),s.node.addClass("note-can-edit"),this.enterState("dragging",{note
:s,element:s.node,dragMetadata:{type:"resize",startX:Math.min(o.x,t.clientX)+window.pageXOffset,startY:Math.min(o.y,t.clientY)+window.pageYOffset,dragHandle:s.node.one(".note-drag-handle-"+l),direction:l}})}.bind(this))))},handleIdleMouseUp:function(t){this.tempMouseMoveListener&&(this.tempMouseMoveListener.detach(),delete this.tempMouseMoveListener),t.target===this.box&&e.fire("photo:zoom",{x:t.pageX,y:t.pageY})},handleIdleMouseEnter:function(e){var t=e.target.ancestor(".note",!0),n=this.getNoteByID(t.getAttribute("data-note-yuid")),r=n.getScaled(this.ratio),i;this.delayedNoteMouseLeaveHandler&&(this.hideHovered(),clearTimeout(this.delayedNoteMouseLeaveHandler),delete this.delayedNoteMouseLeaveHandler),t.addClass("note-hovered"),t.insert(this.templates("photo-note-read-mode")({x:r.x,y:r.y+r.h+u,z:s,text:n.text.replace(/\n/g,"<br>"),authorName:n.authorRealName||n.authorName,authorURL:"/photos/"+n.author+"/",authorIsPro:n.authorIsPro}),"after"),i=this.box.one(".note-text"),i.on("mouseenter",function(e){this.delayedNoteMouseLeaveHandler&&(clearTimeout(this.delayedNoteMouseLeaveHandler),delete this.delayedNoteMouseLeaveHandler)}.bind(this)),i.on("mouseleave",this.handleIdleMouseLeave.bind(this))},handleIdleMouseLeave:function(e){this.delayedNoteMouseLeaveHandler=setTimeout(this.hideHovered.bind(this),o)},beginEditing:function(e){var t=e.note,n=e.element,r=t.getScaled(this.ratio);this.storeNoteBackup(t),this.hideHovered(),this.box.hasClass("box-note-clicked")||this.box.addClass("box-note-clicked"),n.hasClass("note-clicked")||n.addClass("note-clicked"),n.siblings(".note-text.adding").size()===0&&n.insert(this.templates("photo-note-write-mode")({noteYUID:t.yuid,x:r.x,y:r.y+r.h+u,z:s,text:t.text.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),canDelete:t.isStoredOnServer}),"after"),n.one(".note-drag-handle")||n.append(this.templates("photo-note-drag-handles")()),setTimeout(function(){this.box.one(".note-text[data-for-note-yuid="+t.yuid+"] textarea").focus()}.bind(this),10)},handleEditingMouseDown:function(e){var t,n,r;if(e.button!==1||e.ctrlKey||e.metaKey)return;n=e.target.ancestor(".note",!0);if(!n)return;t=this.getNoteByID(n.getAttribute("data-note-yuid"));if(!t)return;t.canEdit&&(e.target.hasClass("note-drag-handle")?r={type:"resize",startX:e.clientX+window.pageXOffset,startY:e.clientY+window.pageYOffset,dragHandle:e.target,direction:e.target.getAttribute("data-drag-resize-direction")}:e.target.hasClass("note-clicked")&&(r={type:"move",startX:e.clientX+window.pageXOffset,startY:e.clientY+window.pageYOffset,dragHandle:e.target}),r&&this.enterState("dragging",{note:t,element:n,dragMetadata:r}))},handleEditingMouseUp:function(e){e.target.test("button")&&this.performButtonAction(e)},handleEditingKeyDown:function(e){var t=this.box.one(".note-clicked"),n=this.getNoteByID(t.getAttribute("data-note-yuid"));switch(e.keyCode){case 8:(e.ctrlKey||e.metaKey)&&window.confirm(this.intlMessage({intlName:"photo-page-scrappy.CONFIRM_NOTE_DELETION"}))&&(this.deleteNote(n,t),e.preventDefault());break;case 13:if(e.ctrlKey||e.metaKey)this.saveNoteEdits(n,t),e.preventDefault();e.target.test("button")&&this.performButtonAction(e);break;case 27:this.cancelNoteEdits(n,t);break;case 32:e.target.test("button")&&this.performButtonAction(e)}},performButtonAction:function(e){var t=this.box.one(".note-clicked"),n=this.getNoteByID(t.getAttribute("data-note-yuid"));e.target.hasClass("save-note")?this.saveNoteEdits(n,t):e.target.hasClass("cancel-note")?this.cancelNoteEdits(n,t):e.target.hasClass("delete-note")&&window.confirm(this.intlMessage({intlName:"photo-page-scrappy.CONFIRM_NOTE_DELETION"}))&&this.deleteNote(n,t)},saveNoteEdits:function(e,t){var n=this.get("noteModel"),r=this;e.text=r.box.one(".note-text[data-for-note-yuid="+e.yuid+"] textarea").get("value").trim();if(!e.text)return;e.isStoredOnServer?(n.setValues(e.id,{left:e.x,top:e.y,width:e.w,height:e.h,text:e.text}),n.remoteUpdate(e.id).then(function(n){n&&(e.text=n.getValue("text")),r.deleteNoteBackup(),r.enterState("idle",{note:e,element:t,rerender:!0})},function(e){})):n.remoteCreate({photoId:e.photoId,left:e.x,top:e.y,width:e.w,height:e.h,text:e.text,author:e.author,authorName:e.authorName,authorRealName:e.authorRealName,authorIsPro:e.authorIsPro}).then(function(n){e.id=n.getValue("id"),e.text=n.getValue("text"),e.isStoredOnServer=!0,r.deleteNoteBackup(),r.enterState("idle",{note:e,element:t,rerender:!0})},function(e){})},cancelNoteEdits:function(e,t){var n;e.isStoredOnServer?(n=this.getNoteBackup(),e.w=n.w,e.h=n.h,e.x=n.x,e.y=n.y,this.positionNote(e)):(this.notes.pop(),this.box.one("[data-note-yuid="+e.yuid+"]").remove(!0),e=null,t=null),this.deleteNoteBackup(),this.enterState("idle",{note:e,element:t})},deleteNote:function(e,t){var n=this.get("noteModel"),r=this,i=!1,s;n.remoteDelete(e.id).then(function(n){t.remove(!0);for(s=r.notes.length-1;s>=0;s--)if(r.notes[s].id===e.id){i=!0;break}i&&r.notes.splice(s,1),r.deleteNoteBackup(),r.enterState("idle",{note:e,element:t})},function(e){})},beginDragging:function(t){this.draggingMemo=e.merge(t.dragMetadata,{note:t.note,noteAtStart:e.clone(t.note),element:t.element})},endDragging:function(e){this.box.removeClass("doing-initial-drag")},handleDraggingMouseMove:function(e){var t=19/this.ratio,n,r,i,s,o,u,a,f,l,c,h,p,d,v;n=this.draggingMemo.note,i=this.draggingMemo.startX-e.clientX-window.pageXOffset,s=this.draggingMemo.startY-e.clientY-window.pageYOffset,this.boxWidth>this.boxHeight?(d=500,v=500/(this.boxWidth/this.boxHeight)):(v=500,d=500/(this.boxHeight/this.boxWidth));if(this.draggingMemo.type==="resize"){r=this.draggingMemo.direction;switch(r){case"tl":o=i/this.ratio*-1,a=i/this.ratio,u=s/this.ratio*-1,f=s/this.ratio;break;case"tr":o=0,a=i/this.ratio*-1,u=s/this.ratio*-1,f=s/this.ratio;break;case"br":o=0,a=i/this.ratio*-1,u=0,f=s/this.ratio*-1;break;case"bl":o=i/this.ratio*-1,a=i/this.ratio,u=0,f=s/this.ratio*-1}l=this.draggingMemo.noteAtStart.x+o,h=this.draggingMemo.noteAtStart
.w+a,c=this.draggingMemo.noteAtStart.y+u,p=this.draggingMemo.noteAtStart.h+f,h<t&&(o&&(l=this.draggingMemo.noteAtStart.w+this.draggingMemo.noteAtStart.x-t),h=t),h+l>d&&(h=d-l),l<0&&(l=0,h=this.draggingMemo.noteAtStart.w+this.draggingMemo.noteAtStart.x),n.x=l,n.w=h,p<t&&(u&&(c=this.draggingMemo.noteAtStart.h+this.draggingMemo.noteAtStart.y-t),p=t),p+c>v&&(p=v-c),c<0&&(c=0,p=this.draggingMemo.noteAtStart.h+this.draggingMemo.noteAtStart.y),n.y=c,n.h=p}else this.draggingMemo.type==="move"&&(l=this.draggingMemo.noteAtStart.x-i/this.ratio,c=this.draggingMemo.noteAtStart.y-s/this.ratio,l<0&&(l=0),l+this.draggingMemo.noteAtStart.w>d&&(l=d-this.draggingMemo.noteAtStart.w),c<0&&(c=0),c+this.draggingMemo.noteAtStart.h>v&&(c=v-this.draggingMemo.noteAtStart.h),n.x=l,n.y=c);this.positionNote(n)},handleDraggingMouseUp:function(e){this.enterState("editing",{note:this.draggingMemo.note,element:this.draggingMemo.element})},storeNoteBackup:function(t){this.noteBeforeEdits||(this.noteBeforeEdits=e.clone(t))},getNoteBackup:function(){return this.noteBeforeEdits},deleteNoteBackup:function(){delete this.noteBeforeEdits},getNoteByID:function(e){return this.notes.find?this.notes.find(function(t){return t.yuid===e}):this.notes.filter(function(t){return t.yuid===e})[0]},renderNotes:function(){var t=this.getNoteBackup(),n,r;t&&(n=e.clone(t.node.getDOMNode())),this.box.all(".note").remove(!0),this.notes.forEach(this.createNewNote.bind(this)),t&&(r=this.box.one("[data-note-yuid="+t.yuid+"]"),r.set("className",n.className),t.node=r)},createNewNote:function(t){t.node=e.Node.create('<span class="note" data-note-yuid="'+t.yuid+'"></span>'),t.canEdit&&t.node.addClass("note-can-edit"),this.box.append(t.node),this.positionNote(t)},positionNote:function(e){var t=e.getScaled(this.ratio),n;e.node.setStyles({left:t.x+"px",top:t.y+"px",width:t.w+"px",height:t.h+"px",zIndex:e.z}),n=this.box.one(".note-text[data-for-note-yuid="+e.yuid+"]"),n&&(n.setStyle("z-index",s),n.one(".text-alignment-fix").setStyles({left:t.x+"px",top:t.y+t.h+u+"px"}))},restackNotes:function(){this.notes.sort(function(e,t){return t.w*t.h-e.w*e.h}).forEach(function(e){e.z=s++})},syncWithPhoto:function(){var t=e.one(".photo-well-media-scrappy-view").getDOMNode(),n=parseInt(getComputedStyle(t).paddingTop,10),r=parseInt(getComputedStyle(t).paddingBottom,10),i=t.offsetWidth,s=t.offsetHeight-n-r,o=t.offsetLeft,u=t.offsetTop+n;this.box.setStyles({width:i+"px",height:s+"px",left:o+"px",top:u+"px"}),this.ratio=Math.max(i,s)/500,this.boxWidth=i,this.boxHeight=s,this.boxLeft=o,this.boxTop=u},hideHovered:function(){this.box.all(".note-hovered").removeClass("note-hovered"),this.box.all(".note-text:not(.adding)").remove(!0)},deactivate:function(){this.get("container").setStyle("display","none").remove()}})},"@VERSION@",{requires:["hermes-template-photo-note-read-mode","hermes-template-photo-note-write-mode","hermes-template-photo-note-drag-handles","flickr-view"],optional:["photo-notes-models","photo-models"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-photo-sidebar-toggle",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return"Close"},3:function(e,t,n,r,i){return"Open"},5:function(e,t,n,r,i){return"fullscreen"},7:function(e,t,n,r,i){return"&#10529;"},9:function(e,t,n,r,i){return"&#10530;"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{};return'<a href="'+e.escapeExpression((o=(o=n.url||(t!=null?t.url:t))!=null?o:n.helperMissing,typeof o=="function"?o.call(u,{name:"url",hash:{},data:i}):o))+'" class="toggle" data-track="lightbox'+((s=n["if"].call(u,t!=null?t.isRealFullscreen:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+'Click">\n	<span class="toggle-icon hide-text '+((s=n["if"].call(u,t!=null?t.isRealFullscreen:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">'+((s=n["if"].call(u,t!=null?t.isRealFullscreen:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+"</span>\n</a>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-sidebar-toggle",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-sidebar-toggle-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{initializer:function(t){return this.photoId=t.photoId,this.realFullscreen=!!t.realFullscreen,this.contextData=e.clone(t.context,!0),this},loadState:function(){var t=this,n=[];return n.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){e&&t.set("photo",e)})),this.contextData&&this.contextData.modelName&&this.contextData.params&&n.push(this.appContext.getModel(this.contextData.modelName,this.contextData.params).then(function(e){e&&t.set("contextModel",e)}).then(null,function(){return"whatever"})),e.Promise.all(n)},getLightboxURL:function(){var t,n=this.get("photo"),r="";return this.get("contextModel")&&(r=this.get("contextModel").getValue("urlSuffix")),t=n?e.URLHelper.getPhotoPage({photoId:n.getValue("id"),pathAlias:n.getValue("owner").getValue("pathAlias"),contextSuffix:r,lightbox:!this.appContext.experiments.fullscreen.getMode()}):"#",t},buildContainer:function(){var e=this.appContext.experiments.fullscreen.getMode();return this.setContainerWithTemplate("photo-sidebar-toggle",{isRealFullscreen:e,url:this.getLightboxURL()}),this.get("container").addClass("show"),this},activate:function(){var t=this,n=this.appContext.getViewer().prefs.keyboardShortcutsEnabled;return n&&(this.attachKeyEvent("down:76",function(n){n.preventDefault(),e.rapidTracker.beacon(t.name,"lightbox"+(t.appContext.experiments.fullscreen.getMode()?"Close":"Open")+"KeyPress"),t.appContext.flapp.navigate(t.getLightboxURL())}),this.appContext.flipper.isFlipped("enable-scrappy-photo-page")&&this.attachKeyEvent("up:27",function(n){t.appContext.experiments.fullscreen.getMode()&&(n.preventDefault(),e.rapidTracker.beacon(t.name,"lightboxCloseEscKeyPress"),t.appContext.flapp.navigate(t.getLightboxURL()))})),this}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-sidebar-toggle","promise"]});
YUI.add("hermes-template-account-menu",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return'	<div class="c-account-menu">\n		<div class="c-account-buddyicon">\n			<a href="/account">\n				<div class="avatar person tiny" style="background-image: url('+e.escapeExpression(e.lambda((s=(s=t!=null?t.user:t)!=null?s.buddyicon:s)!=null?s["default"]:s,t))+')"></div>\n			</a>\n\n			'+((s=n["if"].call(t!=null?t:{},(s=t!=null?t.user:t)!=null?s.unreadMessages:s,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n		</div>\n	</div>\n"},2:function(e,t,n,r,i){var s;return'<span class="c-account-unreadcount">'+e.escapeExpression(e.lambda((s=t!=null?t.user:t)!=null?s.unreadMessages:s,t))+"</span>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},(s=t!=null?t.user:t)!=null?s.signedIn:s,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:""},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/account-menu",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-greetings",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=e.lambda,u=e.escapeExpression,a=t!=null?t:{},f=n.helperMissing;return"<h4>Hola, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SPANISH"},data:i}))+"</p>\n<h4>Guten Tag, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_GERMAN"},data:i}))+"</p>\n<h4>Servus, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_GERMAN"},data:i}))+"</p>\n<h4>G&rsquo;day, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_AUSTRALIAN"},data:i}))+"</p>\n<h4>Hoi, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_DUTCH"},data:i}))+"</p>\n<h4>Yo, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:i}))+"</p>\n<h4>Hi, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:i}))+"</p>\n<h4>Oi, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:i}))+"</p>\n<h4>Hala, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ARABIC"},data:i}))+"</p>\n<h4>Ahoy, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:i}))+"</p>\n<h4>Hello, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:i}))+"</p>\n<h4>Bonjour, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_FRENCH"},data:i}))+"</p>\n<h4>Salut, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_FRENCH"},data:i}))+"</p>\n<h4>Salaam, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ARABIC"},data:i}))+"</p>\n<h4>Ciao, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ITALIAN"},data:i}))+"</p>\n<h4>Hola, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SPANISH"},data:i}))+"</p>\n<h4>Hej, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SWEDISH"},data:i}))+"</p>\n<h4>Aloha, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HAWAIIAN"},data:i}))+"</p>\n<h4>Kumusta, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_TAGALOG"},data:i}))+"</p>\n<h4>Shalom, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HEBREW"},data:i}))+"</p>\n<h4>'Allo, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:i}))+"</p>\n<h4>Namaste, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HINDI"},data:i}))+"</p>\n<h4>Ni hao, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_MANDARIN"},data:i}))+"</p>\n<h4>Ol&aacute;, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_PORTUGUESE"},data:i}))+"</p>\n<h4>P&euml;rsh&euml;ndetje, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ALBANIAN"},data:i}))+"</p>\n<h4>Tere, "+
u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ESTONIAN"},data:i}))+"</p>\n<h4>Yasou, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_GREEK"},data:i}))+"</p>\n<h4>Szia, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HUNGARIAN"},data:i}))+"</p>\n<h4>Mbote, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_LINGALA"},data:i}))+"</p>\n<h4>Jambo, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SWAHILI"},data:i}))+"</p>\n<h4>Moyo, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_TSHILUBA"},data:i}))+"</p>\n<h4>Merhaba, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_TURKISH"},data:i}))+"</p>\n<h4>Mingalaba, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_BURMESE"},data:i}))+"</p>\n<h4>G&#243;&#240;an daginn, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ICELANDIC"},data:i}))+"</p>\n<h4>Sawubona, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ZULU"},data:i}))+"</p>\n<h4>Bangawoyo, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_KOREAN"},data:i}))+"</p>\n<h4>F&aacute;ilte, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_IRISH"},data:i}))+"</p>\n<h4>Labdien, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_LATVIAN"},data:i}))+"</p>\n<h4>Kaixo, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_BASQUE"},data:i}))+"</p>\n<h4>Nomoshkar, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_BENGALI"},data:i}))+"</p>\n<h4>Zdrasti, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_BULGARIAN"},data:i}))+"</p>\n<h4>Bok, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_CROATIAN"},data:i}))+"</p>\n<h4>Dobr&yacute; den, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_CZECH"},data:i}))+"</p>\n<h4>Hej, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_DANISH"},data:i}))+"</p>\n<h4>Hyv&auml;&auml; p&auml;iv&auml;&auml;, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_FINNISH"},data:i}))+"</p>\n<h4>Mike, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HOPI"},data:i}))+"</p>\n<h4>Szia, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HUNGARIAN"},data:i}))+"</p>\n<h4>Halo, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_INDONESIAN"},data:i}))+"</p>\n<h4>Namaskara, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_KANNADA"},data:i}))+"</p>\n<h4>Chon\u00ee, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_KURDISH"},data:i}))+"</p>\n<h4>Labas, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||
f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_LITHUANIAN"},data:i}))+"</p>\n<h4>Selamat datang, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_MALAYSIAN"},data:i}))+"</p>\n<h4>Hei, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_NORWEGIAN"},data:i}))+"</p>\n<h4>Witaj, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_POLISH"},data:i}))+"</p>\n<h4>Bun&#x103; Ziua, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ROMANIAN"},data:i}))+"</p>\n<h4>Privet, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_RUSSIAN"},data:i}))+"</p>\n<h4>Zdravo, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SERBIAN"},data:i}))+"</p>\n<h4>Ahoj, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SLOVAKIAN"},data:i}))+"</p>\n<h4>Pryvit, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_UKRAINIAN"},data:i}))+"</p>\n<h4>Xin ch&agrave;o, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_VIETNAMESE"},data:i}))+"</p>\n<h4>Sawubona, "+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.username:s,t))+"!</h4><p>"+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ZULU"},data:i}))+"</p> \n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u;return s=(o=(o=n.randomLine||(t!=null?t.randomLine:t))!=null?o:n.helperMissing,u={name:"randomLine",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i},typeof o=="function"?o.call(t!=null?t:{},u):o),n.randomLine||(s=n.blockHelperMissing.call(t,s,u)),s!=null?s:""},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/greetings",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-account-menu-dialog-styleguide",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return'				<span class="photo-count secondary">'+e.escapeExpression((n.intlHTMLMessage||t&&t.intlHTMLMessage||n.helperMissing).call(t!=null?t:{},{name:"intlHTMLMessage",hash:{used:(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.storageUsedFormatted:s,intlName:"account-menu.SPACE_USED_UNLIMITED"},data:i}))+"</span>\n"},3:function(e,t,n,r,i){var s,o=t!=null?t:{},u=e.escapeExpression;return((s=n["if"].call(o,(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.photoCount:s,{name:"if",hash:{},fn:e.program(4,i,0),inverse:e.program(12,i,0),data:i}))!=null?s:"")+'			<span class="storage-count secondary">'+u((n.intlHTMLMessage||t&&t.intlHTMLMessage||n.helperMissing).call(o,{name:"intlHTMLMessage",hash:{total:(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.storageTotalFormatted:s,percentage:(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.storageUsedPercentage:s,intlName:"account-menu.SPACE_USED_STYLEGUIDE"},data:i}))+'</span></div>\n			<div class="bar" style="box-shadow: 0 0 0 1px #898989, inset '+u(e.lambda((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.barWidth:s,t))+'px 0 #008ddf;">\n'},4:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.pluralPhotos:s,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.program(10,i,0),data:i}))!=null?s:""},5:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.oneK:s,{name:"if",hash:{},fn:e.program(6,i,0),inverse:e.program(8,i,0),data:i}))!=null?s:""},6:function(e,t,n,r,i){var s;return'					<span class="photo-count secondary">'+e.escapeExpression((n.intlHTMLMessage||t&&t.intlHTMLMessage||n.helperMissing).call(t!=null?t:{},{name:"intlHTMLMessage",hash:{num:(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.photoCount:s,intlName:"account-menu.PHOTO_COUNT_1K"},data:i}))+"</span>\n"},8:function(e,t,n,r,i){var s;return'					<span class="photo-count secondary">'+e.escapeExpression((n.intlHTMLMessage||t&&t.intlHTMLMessage||n.helperMissing).call(t!=null?t:{},{name:"intlHTMLMessage",hash:{num:(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.photoCount:s,intlName:"account-menu.PHOTO_COUNT_MANY"},data:i}))+"</span>\n"},10:function(e,t,n,r,i){return'				<span class="photo-count secondary">'+e.escapeExpression((n.intlHTMLMessage||t&&t.intlHTMLMessage||n.helperMissing).call(t!=null?t:{},{name:"intlHTMLMessage",hash:{intlName:"account-menu.PHOTO_COUNT_ONE"},data:i}))+"</span>\n"},12:function(e,t,n,r,i){return'				<span class="photo-count secondary">'+e.escapeExpression((n.intlHTMLMessage||t&&t.intlHTMLMessage||n.helperMissing).call(t!=null?t:{},{name:"intlHTMLMessage",hash:{intlName:"account-menu.PHOTO_COUNT_NONE"},data:i}))+"</span>\n"},14:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.canBuyPro:s,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.program(17,i,0),data:i}))!=null?s:""},15:function(e,t,n,r,i){return'				<div class="upgrade">\n					<a href="/account/upgrade/pro" data-action="follow" class="small butt">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"account-menu.GOPRO"},data:i}))+"</a>\n				</div>\n"},17:function(e,t,n,r,i){var s;return"\n"+((s=(n.isNotFlipped||t&&t.isNotFlipped||n.helperMissing).call(t!=null?t:{},"enable-new-pro",{name:"isNotFlipped",hash:{},fn:e.program(18,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"},18:function(e,t,n,r,i){return'\n					<div class="upgrade">\n						<a href="/account/upgrade/adfree" data-action="follow" class="small butt">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"account-menu.GOADFREE"},data:i}))+"</a>\n					</div>\n\n"},20:function(e,t,n,r,i){var s;return"<span >&nbsp;("+e.escapeExpression(e.lambda((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.unreadMessages:s,t))+")</span>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=e.lambda,u=e.escapeExpression,a=t!=null?t:{},f=n.helperMissing;return'<div class="fluid">\n	<div class="top-half dark" style="background-image: url('+u(o((s=(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.coverPhotoUrls:s)!=null?s.t:s,t))+')">\n		<a href="/photos/me"><span class="avatar person medium" style="background-image: url('+u(o((s=(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.buddyicon:s)!=null?s["default"]:s,t))+')"></span></a>\n'+((s=e.invokePartial(r.greetings,t,{name:"greetings",data:i,indent:"		",helpers:n,partials:r,decorators:e.decorators}))!=null?s:"")+'	</div>\n	<div class="bottom-half light">\n		<div class="labels">\n'+((s=n["if"].call(a,(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.isPro:s,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+"		</div>\n\n"+((s=n.unless.call(a,(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.isNoAds:s,{name:"unless",hash:{},fn:e.program(14,i,0),inverse:e.noop,data:i}))!=null?s:"")+'\n\n		<div class="links secondary">\n			<span class="link-wrapper">\n				<ul>\n					<li><a href="/mail"  data-action="follow">'+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"common.FLICKRMAIL"},data:i}))+((s=n["if"].call(a,(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.unreadMessages:s,{name:"if",hash:{},fn:e.program(20,i,0),inverse:e.noop,data:i}))!=null?s:"")+'</a></li>\n					<li><a href="https://help.yahoo.com/flickr"  data-action="follow">'+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"common.HELP"},data:i}))+'</a></li>\n					<li><a href="/account"  data-action="follow">'+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"common.SETTINGS"},data:i}))+'</a></li>\n					<li><a href="/logout.gne?csrf='+u(o((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.csrf:
s,t))+'"  data-action="follow">'+u((n.intlMessage||t&&t.intlMessage||f).call(a,{name:"intlMessage",hash:{intlName:"common.SIGN_OUT"},data:i}))+"</a></li>\n				</ul>\n			</span>\n		</div>\n	</div>\n</div>"},usePartial:!0,useData:!0}),r={};e.Array.each(["greetings"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/account-menu-dialog-styleguide",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-greetings"]});
YUI.add("hermes-template-account-menu-card",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.isPro:s,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(4,i,0),data:i}))!=null?s:""},2:function(e,t,n,r,i){var s;return'					<span class="storage-count tertiary">'+e.escapeExpression((n.intlHTMLMessage||t&&t.intlHTMLMessage||n.helperMissing).call(t!=null?t:{},{name:"intlHTMLMessage",hash:{used:(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.storageUsedFormatted:s,intlName:"account-menu.SPACE_USED_UNLIMITED"},data:i}))+"</span>\n"},4:function(e,t,n,r,i){var s,o=e.escapeExpression;return'					<div class="bar" style="box-shadow: 0 0 0 1px transparent, inset '+o(e.lambda((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.barWidth:s,t))+'px 0 #008ddf;">\n						<span class="storage-count tertiary">'+o((n.intlHTMLMessage||t&&t.intlHTMLMessage||n.helperMissing).call(t!=null?t:{},{name:"intlHTMLMessage",hash:{total:(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.storageTotalFormatted:s,percentage:(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.storageUsedPercentage:s,intlName:"account-menu.SPACE_USED"},data:i}))+"</span>\n					</div>\n"},6:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.hasUnlimitedStorage:s,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(4,i,0),data:i}))!=null?s:""},8:function(e,t,n,r,i){return'				<div class="upgrade" style="display: none;">\n					<a href="/account/upgrade/pro" data-action="follow" class="small butt"><div class="balls"></div></a>\n				</div>\n'},10:function(e,t,n,r,i){var s;return"\n"+((s=(n.isNotFlipped||t&&t.isNotFlipped||n.helperMissing).call(t!=null?t:{},"enable-new-pro",{name:"isNotFlipped",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"},11:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.canBuyPro:s,{name:"if",hash:{},fn:e.program(12,i,0),inverse:e.program(14,i,0),data:i}))!=null?s:""},12:function(e,t,n,r,i){return'					<div class="upgrade">\n						<a href="/account/upgrade/pro" data-action="follow" class="small butt">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"account-menu.GOPRO"},data:i}))+"</a>\n					</div>\n"},14:function(e,t,n,r,i){var s;return"\n"+((s=(n.isNotFlipped||t&&t.isNotFlipped||n.helperMissing).call(t!=null?t:{},"enable-new-pro",{name:"isNotFlipped",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"},15:function(e,t,n,r,i){return'\n						<div class="upgrade">\n							<a href="/account/upgrade/adfree" data-action="follow" class="small butt">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"account-menu.GOADFREE"},data:i}))+"</a>\n						</div>\n\n"},17:function(e,t,n,r,i){var s;return"<span >&nbsp;("+e.escapeExpression(e.lambda((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.unreadMessages:s,t))+")</span>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression,f=e.lambda;return'<div class="fluid account-menu-card">\n	<div class="title">\n'+((s=e.invokePartial(r.greetings,t,{name:"greetings",data:i,indent:"		",helpers:n,partials:r,decorators:e.decorators}))!=null?s:"")+'	</div>\n	<div class="info">\n		<div class="labels">\n\n'+((s=(n.isNotFlipped||t&&t.isNotFlipped||u).call(o,"enable-new-pro",{name:"isNotFlipped",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=(n.isFlipped||t&&t.isFlipped||u).call(o,"enable-new-pro",{name:"isFlipped",hash:{},fn:e.program(6,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n		</div>\n\n"+((s=(n.isFlipped||t&&t.isFlipped||u).call(o,"enable-new-pro",{name:"isFlipped",hash:{},fn:e.program(8,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"+((s=n.unless.call(o,(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.isNoAds:s,{name:"unless",hash:{},fn:e.program(10,i,0),inverse:e.noop,data:i}))!=null?s:"")+'\n\n		<div class="links secondary">\n			<span class="link-wrapper">\n				<ul>\n					<li><a href="/mail"  data-action="follow">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.FLICKRMAIL"},data:i}))+((s=n["if"].call(o,(s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.unreadMessages:s,{name:"if",hash:{},fn:e.program(17,i,0),inverse:e.noop,data:i}))!=null?s:"")+'</a></li>\n					<li><a href="//help.yahoo.com/kb/index?page=product&locale='+a(f((s=t!=null?t.attrs:t)!=null?s.helpLocaleKey:s,t))+'&y=PROD_FLICKR_DESK&actp=productlink"  data-action="follow">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.HELP"},data:i}))+'</a></li>\n					<li><a href="/account"  data-action="follow">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.SETTINGS"},data:i}))+'</a></li>\n					<li><a href="/logout.gne?csrf='+a(f((s=(s=t!=null?t.attrs:t)!=null?s.user:s)!=null?s.csrf:s,t))+'"  data-action="follow">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.SIGN_OUT"},data:i}))+"</a></li>\n				</ul>\n			</span>\n		</div>\n	</div>\n</div>\n"},usePartial:!0,useData:!0}),r={};e.Array.each(["greetings"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/account-menu-card",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-greetings"]});
YUI.add("hermes-template-account-menu-card-get-pro-button",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return'	<div class="upgrade">\n		<a href="/account/upgrade/pro" data-action="follow" class="small butt">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"account-menu.GETPRO"},data:i}))+"</a>\n	</div>\n"},3:function(e,t,n,r,i){return'	<div class="upgrade">\n		<a href="/account/upgrade/pro" data-action="follow" class="small butt">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"account-menu.RESUBSCRIBE_TO_PRO"},data:i}))+"</a>\n	</div>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return((s=n["if"].call(o,t!=null?t.canPurchase:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.canResubscribe:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/account-menu-card-get-pro-button",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("flickr-products-discounts-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.Promise.resolve()},create:function(t){return e.Promise.resolve()},"delete":function(t){return e.Promise.resolve()}},attributes:{costDiscount:{setter:function(e){return e?parseFloat(e).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(e){return parseFloat(0).toFixed(2)}},couponId:{},discountType:{},discountValue:{setter:function(e){return e?parseFloat(e).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(e){return parseFloat(0).toFixed(2)}},minPurchaseValue:{setter:function(e){return e?parseFloat(e).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(e){return parseFloat(0).toFixed(2)}},productEntity:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});
YUI.add("flickr-products-order-items-setQuantity-updater",function(e,t){"use strict";function n(e,t,n){}function r(r,i){return i.callAPI("flickr.products.orders.setItemQuantity",r).then(function(e){n(e,r,i)},e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-products-order-items-setQuantity-updater"]={run:r}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("products-order-item-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{update:function(t,n){var r;return"quantity"in n?(r={order_id:this.getValue(t,"orderId"),product_id:t,quantity:n.quantity.newVal},e.ModelUpdaters["flickr-products-order-items-setQuantity-updater"].run(r,this.appContext)):e.Promise.resolve()}},attributes:{orderId:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},sourceProductId:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},productType:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},productTitle:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},quantity:{validator:function(t,n){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},cost:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},skuId:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},price:{isModel:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-products-order-items-setQuantity-updater"]});
YUI.add("products-order-item-price-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{orderItemId:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},priceBase:{setter:function(e){return e?parseFloat(e).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(e){return parseFloat(0).toFixed(2)}},countPagesBase:{getter:function(e){return parseInt(e,10)},validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},countPagesExtra:{getter:function(e){return parseInt(e,10)},validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},pricePerPage:{setter:function(e){return e?parseFloat(e).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(e){return parseFloat(0).toFixed(2)}},pricePagesExtra:{setter:function(e){return e?parseFloat(e).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(e){return parseFloat(0).toFixed(2)}},priceTotal:{setter:function(e){return e?parseFloat(e).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(e){return parseFloat(0).toFixed(2)}},standardShippingBase:{setter:function(e){return e?parseFloat(e).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(e){return parseFloat(0).toFixed(2)}},standardShippingExtra:{setter:function(e){return e?parseFloat(e).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(e){return parseFloat(0).toFixed(2)}},expressShippingBase:{setter:function(e){return e?parseFloat(e).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(e){return parseFloat(0).toFixed(2)}},expressShippingExtra:{setter:function(e){return e?parseFloat(e).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(e){return parseFloat(0).toFixed(2)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-products-order-items-setQuantity-updater"]});
YUI.add("flickr-products-orders-removeCoupon-deletor",function(e,t){"use strict";function n(e){var t={};return t.order_id=e.orderId,t.coupon_code=e.couponCode,t}function r(t){var n,r,i,s,o,u,a,f;return f=t.response,n=t.orderRegistry,r=t.couponRegistry,i=t.discountRegistry,s=t.itemRegistry,o=t.itemPriceRegistry,a={orderRegistry:n,orderItemRegistry:s,itemPriceRegistry:o,couponRegistry:r,discountRegistry:i},n.remove(f.order.orderId),u=e.ProductsAPIHelper.parseOrder(f.order,a),u}function i(n,r){var i=this;return(new e.FlickrPromise({response:r.callAPI("flickr.products.orders.removeCoupon",i._processParams(n)),orderRegistry:r.getModelRegistry("flickr-products-orders-models"),couponRegistry:r.getModelRegistry("flickr-products-coupons-models"),discountRegistry:r.getModelRegistry("flickr-products-discounts-models"),itemRegistry:r.getModelRegistry("products-order-item-models"),itemPriceRegistry:r.getModelRegistry("products-order-item-price-models")})).then(i._processResponse,e.FetcherErrorLogger(t))}e.namespace("ModelDeletors")["flickr-products-orders-removeCoupon"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","products-api-helper"],optional:["flickr-products-orders-models","flickr-products-coupons-models","flickr-products-discounts-models","products-order-item-models","products-order-item-price-models"]});
YUI.add("flickr-products-coupons-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.Promise.resolve()},create:function(t){return e.ModelCreators["flickr-products-orders-applyCoupon"].run(t,this.appContext)},"delete":function(t,n){return n={couponCode:this.getValue(t,"code"),orderId:this.getValue(t,"orderId")},e.ModelDeletors["flickr-products-orders-removeCoupon"].run(n,this.appContext)}},attributes:{code:{},orderId:{},discounts:{isListProxy:!0},isValidCoupon:{},isUserSpecific:{},isSingleUse:{},invalidReason:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-products-orders-applyCoupon-creator","flickr-products-orders-removeCoupon-deletor"]});
YUI.add("flickr-products-orders-create-creator",function(e,t){"use strict";function n(e){var t={};return e=e||{},t.items=e.bookId||e.items,t.cacheBust=Date.now(),t}function r(t,n,r){var i,s,o,u,a,f,l,c;return c=t.response,i=t.orderRegistry,s=t.couponRegistry,o=t.discountRegistry,u=t.itemRegistry,a=t.itemPriceRegistry,l={orderRegistry:i,orderItemRegistry:u,itemPriceRegistry:a,couponRegistry:s,discountRegistry:o},f=e.ProductsAPIHelper.parseOrder(c.order,l),f}function i(n,r){var i=this;return(new e.FlickrPromise({response:r.callAPI("flickr.products.orders.create",this._processParams(n)),orderRegistry:r.getModelRegistry("flickr-products-orders-models"),couponRegistry:r.getModelRegistry("flickr-products-coupons-models"),discountRegistry:r.getModelRegistry("flickr-products-discounts-models"),itemRegistry:r.getModelRegistry("products-order-item-models"),itemPriceRegistry:r.getModelRegistry("products-order-item-price-models")})).then(function(e){return i._processResponse(e,n,r)},e.FetcherErrorLogger(t))}e.namespace("ModelCreators")["flickr-products-orders-create"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","flickr-products-orders-models","flickr-products-coupons-models","flickr-products-discounts-models","products-order-item-models","products-order-item-price-models"],optional:[]});
