YUI.add("hermes-template-sub-photo-tags-tag-section",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return'	<a href="#" class="show-add-tags">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TAGS"},data:i}))+"</a>\n"},3:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return'	<a class="tag-section-header" href="'+a((s=(s=n.tagPageURL||(t!=null?t.tagPageURL:t))!=null?s:u,typeof s=="function"?s.call(o,{name:"tagPageURL",hash:{},data:i}):s))+'">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.TAGS"},data:i}))+"</a>\n"},5:function(e,t,n,r,i){return'	<h3 class="tag-section-header">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.TAGS"},data:i}))+"</h3>\n"},7:function(e,t,n,r,i){var s;return'	<span class="label-beta">\n'+((s=n["if"].call(t!=null?t:{},t!=null?t.displayAutotagsBetaLabel:t,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.program(10,i,0),data:i}))!=null?s:"")+'	</span>\n	<span class="autotags-helper">\n		<i class="autotags-helper-icon"></i>\n	</span>\n'},8:function(e,t,n,r,i){return"			"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.BETA"},data:i}))+"\n"},10:function(e,t,n,r,i){return"			"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.ALPHA"},data:i}))+"\n"},12:function(e,t,n,r,i){return'		<input type="text" class= "add-tag" placeholder="'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_A_TAG"},data:i}))+'">\n'},14:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'		<li data-author="'+l((o=(o=n.tagAuthorNSID||(t!=null?t.tagAuthorNSID:t))!=null?o:a,typeof o===f?o.call(u,{name:"tagAuthorNSID",hash:{},data:i}):o))+'" data-tag-id="'+l((o=(o=n.id||(t!=null?t.id:t))!=null?o:a,typeof o===f?o.call(u,{name:"id",hash:{},data:i}):o))+'" class="tag '+((s=(n.canRemoveTag||t&&t.canRemoveTag||a).call(u,t!=null?t.tagAuthorNSID:t,(s=i&&i.root)&&s.viewerNSID,(s=i&&i.root)&&s.isOwner,{name:"canRemoveTag",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" '+((s=n["if"].call(u,(s=i&&i.root)&&s.autotagsEnabled,{name:"if",hash:{},fn:e.program(17,i,0),inverse:e.noop,data:i}))!=null?s:"")+' data-track="tagClick">\n			<a class="'+((s=n["if"].call(u,(s=i&&i.root)&&s.autotagsEnabled,{name:"if",hash:{},fn:e.program(20,i,0),inverse:e.program(23,i,0),data:i}))!=null?s:"")+'" href="#">\n				<i class="'+((s=n["if"].call(u,(s=i&&i.root)&&s.autotagsEnabled,{name:"if",hash:{},fn:e.program(25,i,0),inverse:e.program(28,i,0),data:i}))!=null?s:"")+'" title="'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.DELETE"},data:i}))+'"></i>\n			</a>\n			<a href="'+((s=n["if"].call(u,(s=i&&i.root)&&s.linkTagToTagsPage,{name:"if",hash:{},fn:e.program(30,i,0),inverse:e.program(32,i,0),data:i}))!=null?s:"")+'" title="'+l((o=(o=n.tagRaw||(t!=null?t.tagRaw:t))!=null?o:a,typeof o===f?o.call(u,{name:"tagRaw",hash:{},data:i}):o))+'">'+l((o=(o=n.tagRaw||(t!=null?t.tagRaw:t))!=null?o:a,typeof o===f?o.call(u,{name:"tagRaw",hash:{},data:i}):o))+"</a>\n		</li>\n"},15:function(e,t,n,r,i){return"can-remove-tag"},17:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.duplicateAutotagId:t,{name:"if",hash:{},fn:e.program(18,i,0),inverse:e.noop,data:i}))!=null?s:""},18:function(e,t,n,r,i){var s;return'data-autotag-id="'+e.escapeExpression((s=(s=n.duplicateAutotagId||(t!=null?t.duplicateAutotagId:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"duplicateAutotagId",hash:{},data:i}):s))+'"'},20:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.duplicateAutotagId:t,{name:"if",hash:{},fn:e.program(21,i,0),inverse:e.program(23,i,0),data:i}))!=null?s:""},21:function(e,t,n,r,i){return"remove-dual-tag"},23:function(e,t,n,r,i){return"remove-tag"},25:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.duplicateAutotagId:t,{name:"if",hash:{},fn:e.program(26,i,0),inverse:e.program(28,i,0),data:i}))!=null?s:""},26:function(e,t,n,r,i){return"delete-dual-tag"},28:function(e,t,n,r,i){return"delete-tag"},30:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n.url||(t!=null?t.url:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"url",hash:{},data:i}):s))},32:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n.searchUrl||(t!=null?t.searchUrl:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"searchUrl",hash:{},data:i}):s))},34:function(e,t,n,r,i){var s;return(s=n.each.call(t!=null?t:{},t!=null?t.autotags:t,{name:"each",hash:{},fn:e.program(35,i,0),inverse:e.noop,data:i}))!=null?s:""},35:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.isPrivate:t,{name:"if",hash:{},fn:e.program(36,i,0),inverse:e.program(41,i,0),data:i}))!=null?s:""},36:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'				<li class="autotag private '+((s=n["if"].call(u,(s=i&&i.root)&&s.viewerIsOwner,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" data-autotag-content="'+l((o=(o=n.autotagValue||(t!=null?t.autotagValue:t))!=null?o:a,typeof o===f?o.call(u,{name:"autotagValue",hash:{},data:i}):o))+'" data-autotag-id="'+l((o=(o=n.id||(t!=null?t.id:t))!=null?o:a,typeof o===f?o.call(u,{name:"id",hash:{},data:i}):o))+'" data-track="autotagClick">\n'+((s=n["if"].call(u,(s=i&&i.root)&&s.viewerIsOwner,{name:"if",hash:{},fn:e.program(37,i,0),inverse:e.noop,data:i}))!=null?s:"")+'					<span class="private-autotag">\n						<i class="private-autotag-icon" title="'+
l(e.lambda((s=i&&i.root)&&s.privateAutotagHelperText,t))+'"></i>\n					</span>\n					<a href="'+((s=n["if"].call(u,(s=i&&i.root)&&s.linkTagToTagsPage,{name:"if",hash:{},fn:e.program(39,i,0),inverse:e.program(32,i,0),data:i}))!=null?s:"")+'" title="'+l((o=(o=n.autotagValue||(t!=null?t.autotagValue:t))!=null?o:a,typeof o===f?o.call(u,{name:"autotagValue",hash:{},data:i}):o))+'">'+l((o=(o=n.autotagValue||(t!=null?t.autotagValue:t))!=null?o:a,typeof o===f?o.call(u,{name:"autotagValue",hash:{},data:i}):o))+"</a>\n				</li>\n"},37:function(e,t,n,r,i){return'						<span class="remove-autotag">\n							<i class="delete-autotag" title="'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.DELETE"},data:i}))+'"></i>\n						</span>\n'},39:function(e,t,n,r,i){var s,o,u=e.escapeExpression;return u(e.lambda((s=i&&i.root)&&s.tagPageURL,t))+u((o=(o=n.autotagValue||(t!=null?t.autotagValue:t))!=null?o:n.helperMissing,typeof o=="function"?o.call(t!=null?t:{},{name:"autotagValue",hash:{},data:i}):o))},41:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'				<li class="autotag '+((s=n["if"].call(u,(s=i&&i.root)&&s.viewerIsOwner,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" data-autotag-content="'+l((o=(o=n.autotagValue||(t!=null?t.autotagValue:t))!=null?o:a,typeof o===f?o.call(u,{name:"autotagValue",hash:{},data:i}):o))+'" data-autotag-id="'+l((o=(o=n.id||(t!=null?t.id:t))!=null?o:a,typeof o===f?o.call(u,{name:"id",hash:{},data:i}):o))+'" data-track="autotagClick">\n'+((s=n["if"].call(u,(s=i&&i.root)&&s.viewerIsOwner,{name:"if",hash:{},fn:e.program(37,i,0),inverse:e.noop,data:i}))!=null?s:"")+'					<a href="'+((s=n["if"].call(u,(s=i&&i.root)&&s.linkTagToTagsPage,{name:"if",hash:{},fn:e.program(39,i,0),inverse:e.program(32,i,0),data:i}))!=null?s:"")+'" title="'+l((o=(o=n.autotagValue||(t!=null?t.autotagValue:t))!=null?o:a,typeof o===f?o.call(u,{name:"autotagValue",hash:{},data:i}):o))+'">'+l((o=(o=n.autotagValue||(t!=null?t.autotagValue:t))!=null?o:a,typeof o===f?o.call(u,{name:"autotagValue",hash:{},data:i}):o))+"</a>\n				</li>\n"},43:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'			<li data-author="'+l((o=(o=n.tagAuthorNSID||(t!=null?t.tagAuthorNSID:t))!=null?o:a,typeof o===f?o.call(u,{name:"tagAuthorNSID",hash:{},data:i}):o))+'" data-tag-id="'+l((o=(o=n.id||(t!=null?t.id:t))!=null?o:a,typeof o===f?o.call(u,{name:"id",hash:{},data:i}):o))+'" class="tag '+((s=(n.canRemoveTag||t&&t.canRemoveTag||a).call(u,t!=null?t.tagAuthorNSID:t,(s=i&&i.root)&&s.viewerNSID,(s=i&&i.root)&&s.isOwner,{name:"canRemoveTag",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" data-track="tagClick">\n				<a class="remove-tag" href="#">\n					<i class="delete-tag" title="'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.DELETE"},data:i}))+'"></i>\n				</a>\n				<a href="'+((s=n["if"].call(u,(s=i&&i.root)&&s.linkTagToTagsPage,{name:"if",hash:{},fn:e.program(30,i,0),inverse:e.program(32,i,0),data:i}))!=null?s:"")+'" title="'+l((o=(o=n.tagRaw||(t!=null?t.tagRaw:t))!=null?o:a,typeof o===f?o.call(u,{name:"tagRaw",hash:{},data:i}):o))+'">'+l((o=(o=n.tagRaw||(t!=null?t.tagRaw:t))!=null?o:a,typeof o===f?o.call(u,{name:"tagRaw",hash:{},data:i}):o))+"</a>\n			</li>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return((s=n["if"].call(o,t!=null?t.canAddMeta:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"+((s=n["if"].call(o,t!=null?t.linkTagToTagsPage:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.program(5,i,0),data:i}))!=null?s:"")+"\n"+((s=n["if"].call(o,t!=null?t.showTagInfoBlock:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))!=null?s:"")+'\n<ul class="tags-list">\n'+((s=n["if"].call(o,t!=null?t.canAddMeta:t,{name:"if",hash:{},fn:e.program(12,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n.each.call(o,t!=null?t.tags:t,{name:"each",hash:{},fn:e.program(14,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.autotagsEnabled:t,{name:"if",hash:{},fn:e.program(34,i,0),inverse:e.noop,data:i}))!=null?s:"")+'\n	<div style="clear:both;"></div>\n</ul>\n\n<div style="clear:both;"></div>\n\n<div class="machine-tags-section">\n	<ul class="machine-tags-list">\n'+((s=n.each.call(o,t!=null?t.machineTags:t,{name:"each",hash:{},fn:e.program(43,i,0),inverse:e.noop,data:i}))!=null?s:"")+'	</ul>\n\n	<div style="clear:both;"></div>\n</div>\n'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/sub-photo-tags-tag-section",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-sub-photo-tags-tag",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return'data-tag-might-exist="true"'},3:function(e,t,n,r,i){return"remove-dual-tag"},5:function(e,t,n,r,i){return"remove-tag"},7:function(e,t,n,r,i){return"delete-dual-tag"},9:function(e,t,n,r,i){return"delete-tag"},11:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return f((s=(s=n.tagPageURL||(t!=null?t.tagPageURL:t))!=null?s:u,typeof s===a?s.call(o,{name:"tagPageURL",hash:{},data:i}):s))+f((s=(s=n.tagWithoutSlashes||(t!=null?t.tagWithoutSlashes:t))!=null?s:u,typeof s===a?s.call(o,{name:"tagWithoutSlashes",hash:{},data:i}):s))},13:function(e,t,n,r,i){return e.escapeExpression((n.getTagSearchUrl||t&&t.getTagSearchUrl||n.helperMissing).call(t!=null?t:{},t!=null?t.tagValue:t,{name:"getTagSearchUrl",hash:{},data:i}))},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'<li data-tag-id="'+l((o=(o=n.escapedTagRaw||(t!=null?t.escapedTagRaw:t))!=null?o:a,typeof o===f?o.call(u,{name:"escapedTagRaw",hash:{},data:i}):o))+'" '+((s=n["if"].call(u,t!=null?t.mightExist:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+' class="tag" data-validated="false" data-track="tagClick">\n	<a class="'+((s=n["if"].call(u,t!=null?t.isDualTag:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.program(5,i,0),data:i}))!=null?s:"")+'" href="#">\n		<i class="'+((s=n["if"].call(u,t!=null?t.isDualTag:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" title="Delete"></i>\n	</a>\n	<a href="'+((s=n["if"].call(u,t!=null?t.linkTagToTagsPage:t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.program(13,i,0),data:i}))!=null?s:"")+'" title="'+l((o=(o=n.tagRaw||(t!=null?t.tagRaw:t))!=null?o:a,typeof o===f?o.call(u,{name:"tagRaw",hash:{},data:i}):o))+'">'+l((o=(o=n.tagRaw||(t!=null?t.tagRaw:t))!=null?o:a,typeof o===f?o.call(u,{name:"tagRaw",hash:{},data:i}):o))+"</a>\n</li>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/sub-photo-tags-tag",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-tags-helper-text",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s=t!=null?t:{},o=n.helperMissing,u=e.escapeExpression;return'<div class="tags-helper-text">\n	'+u((n.intlMessage||t&&t.intlMessage||o).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.TAGS_HELP_TEXT"},data:i}))+'\n</div>\n<a href="//help.yahoo.com/kb/flickr/tag-keywords-flickr-sln7455.html" target="_blank">'+u((n.intlMessage||t&&t.intlMessage||o).call(s,{name:"intlMessage",hash:{intlName:"common.LEARN_MORE"},data:i}))+"</a>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/tags-helper-text",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("sub-photo-tags-tag-view",function(e,t){var n=require("lib/flog")(t),r={tagHoverMaxWidth:23};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.photoId=t.photoId,this.context=e.clone(t.context,!0),this.nsid=t.nsid,this.pathAlias=t.pathAlias,this.isMobileTags=t.isMobileTags||!1,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var t=this,n=new e.FlickrPromise({photo:t.appContext.getModel("photo-models",t.photoId),photoTags:t.appContext.getModel("photo-tags-models",this.photoId),tagModel:t.appContext.getModelRegistry("tag-models"),photoAutotags:t.appContext.getModel("photo-autotags-models",t.photoId),autotagModel:t.appContext.getModelRegistry("autotag-models")});return n.then(function(e){t.set("photo",e.photo),t.set("photoTags",e.photoTags),t.set("tagModel",e.tagModel),t.set("photoAutotags",e.photoAutotags),t.set("autotagModel",e.autotagModel)})},buildContainer:function(){var e=this,t=this.get("photo"),n=this.get("photoTags"),r=n.getValue("tags"),i=t.getValue("isOwner")||t.getValue("canAddMeta"),s=/^[a-zA-Z]\w*:[a-zA-Z]\w*=.+/,o=[],u=[],a,f=!1,l=!1,c=!1,h=this.get("photoAutotags"),p=h.getValue("autotags"),d=t.getValue("isOwner"),v=!1,m=this.appContext.flipper.isFlipped("enable-photopage-autotags-beta-label"),g=!this.isMobileTags,y=this.appContext.flipper.isFlipped("enable-tag-page-link-on-photo-page");if(r){r=r.toJSON();if(r.length!==0){f=!0;for(a=0;a<r.length;a++)s.test(r[a].tagRaw)?o.push(r[a]):u.push(r[a])}}return p&&(p=p.toJSON(),p.length!==0&&(l=!0,d?v=e.intlMessage({intlName:"photo-page-scrappy.PRIVATE_TAGS_OWNER_HELPER_TEXT"}):v=e.intlMessage({intlName:"photo-page-scrappy.PRIVATE_TAGS_FRIENDS_FAMILY_HELPER_TEXT"}))),!f&&!l&&(c=!0),c&&i&&(this.get("container").addClass("empty"),this.fire("subviewViewEvent","tagsTagView:tagsEmpty")),(i||!c)&&this.setContainerWithTemplate("sub-photo-tags-tag-section",{tags:u,machineTags:o,autotags:p,viewerIsOwner:d,privateAutotagHelperText:v,canAddMeta:t.getValue("isOwner")||t.getValue("canAddMeta"),viewerNSID:this.appContext.getViewer().nsid,isOwner:t.getValue("isOwner"),autotagsEnabled:!0,displayAutotagsBetaLabel:m,showTagInfoBlock:g,linkTagToTagsPage:y,tagPageURL:"/photos/tags/"}),this},activate:function(){var t=this.get("photo"),n=this.get("container"),r=t.getValue("owner")||t.getValue("canAddMeta"),i=this.get("photoTags"),s=i.getValue("tags"),o=/^[a-zA-Z]\w*:[a-zA-Z]\w*=.+/,u=[],a=n.one(".autotags-helper"),f=this,l,c=this.appContext.getViewer().prefs.keyboardShortcutsEnabled;s&&(s=s.toJSON()),s.length===0&&this.fire("subviewViewEvent","noTags");for(l=0;l<s.length;l++)o.test(s[l].tagRaw)&&u.push(s[l]);return u.length&&n.one(".machine-tags-section").setStyle("display","block"),!this.isMobileTags&&r&&n.one(".show-add-tags")&&(n.one(".show-add-tags").on("click",function(e){e.preventDefault(),n.hasClass("empty")&&(n.removeClass("empty"),f.fire("subviewViewEvent","tagsTagView:tagsNotEmpty")),n.one(".add-tag").setStyle("display","block"),n.one(".add-tag").focus()}),this.setupAddTagEvents(),this.setupRollOverTagEvents(),this.setupRemoveTagEvents(),this.registerEventHandler(e.on("flickr:photo-page--new-tags-added",function(){f.buildContainer(),f.setupRollOverTagEvents(),f.setupRemoveTagEvents()})),this.registerEventHandler(e.on("flickr:photo-page:focus_tag_entry",function(e){var t=f.get("container");t&&t.one(".tags-list .add-tag")&&t.one(".tags-list .add-tag").focus()})),c&&this.attachKeyEvent("down:84",function(e){e.preventDefault();try{n.hasClass("empty")&&(n.removeClass("empty"),f.fire("subviewViewEvent","tagsTagView:tagsNotEmpty")),n.one(".add-tag").setStyle("display","block"),n.one(".add-tag").focus()}catch(t){}})),!this.isMobileTags&&a&&this.registerEventHandler(a.on("click",function(e){f.showAutotagsHelper(e)},a)),this},setupAddTagEvents:function(){var e=this.get("container"),t="",n=this;this.registerEventHandler(e.one(".add-tag").on("keydown",function(e){e.charCode===13&&(e.preventDefault(),this.blur())})),this.registerEventHandler(e.one(".add-tag").on("blur",function(){var r=this,i=r.get("value");if(i===t)return;r.set("value",""),i.length===0&&(i='""'),i.trim()!=='""'&&i.trim()!==t?(e.one(".tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),e.one(".tags-list").all(".not-eol").removeClass("not-eol"),e.one(".machine-tags-section").getStyle("display")==="block"&&(e.one(".machine-tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),e.one(".machine-tags-list").all(".not-eol").removeClass("not-eol")),n.saveTag(i),setTimeout(function(){r.focus()},4)):this.set("text",t)}))},_whichTagList:function(){var e=/^[a-zA-Z]\w*:[a-zA-Z]\w*=.+/,t=this.get("container"),n=[t.one(".machine-tags-list"),t.one(".tags-list")];return function(r){return e.test(r)?n[0]:n[1]}},saveTag:function(t){var n=this.get("container"),r=this.get("tagModel"),i=this.get("photoTags").getValue("tags"),s=this.get("photoAutotags").getValue("autotags"),o=!1,u=!1,a=this._whichTagList(),f,l=this,c;c=this.processTag(t),f=c.map(function(e){return e.toLowerCase()}),o=i.getList().some(function(e){return f.indexOf(e.getValue("tagValue").toLowerCase())!==-1}),u=s.getList().some(function(e){return f.indexOf(e.getValue("autotagValue").toLowerCase())!==-1}),r.remoteCreate({photoId:[l.photoId],tags:[t]}).then(function(t){t.forEach(function(e){var t=e.getValue("tagRaw"),n=e.getValue("duplicateAutotagId"),r=a(t),i=r.one("[data-tag-id='"+escape(t)+"']"),s;i.setAttribute("data-tag-id",e.getValue("id")),i.setAttribute("data-validated","true"),i.setAttribute("data-tag-might-exist","false"),i.setAttribute("data-author",e.getValue("tagAuthorNSID")),i.addClass("can-remove-tag"),n&&(s=r.one("[data-autotag-content='"+t+"']"),i.setAttribute("data-autotag-id",e.getValue("duplicateAutotagId")),s.remove(!0))}),e.all("[data-tag-might-exist='true']").set("text",l.intlMessage({intlName:"photo-page-scrappy.DUPLICATE_TAG"})).setAttribute("data-validated","true").addClass("invalid-tag"
),e.all("[data-validated='false']").set("text",l.intlMessage({intlName:"photo-page-scrappy.INVALID_TAG"})).addClass("invalid-tag"),clearTimeout(l.invalidTagRemoval),l.invalidTagRemoval=setTimeout(function(){n.all(".invalid-tag").remove(!0)},4500)},function(e){var t;t=n.all("[data-validated='false']"),n.all(".autotag").removeClass("hidden"),t.size()&&t.remove(),e.code===2?l.onError(l.intlMessage({intlName:"photo-page-scrappy.MAX_TAG_LIMIT"})):l.onError(l.intlMessage({intlName:"photo-page-scrappy.ERROR_ADDING_TAG"}))}),c.forEach(function(e){var t=a(e).show(),r=t.hasClass("machine-tags-list"),i=l.appContext.flipper.isFlipped("enable-tag-page-link-on-photo-page"),s,f,c,h={tagValue:e.replace(/\s/g,""),tagRaw:e,escapedTagRaw:escape(e),mightExist:o,isDualTag:u,tagWithoutSlashes:e.replace(/\//g,""),linkTagToTagsPage:i,tagPageURL:"/photos/tags/"};r?(e.indexOf(" ")>0?(f=e.indexOf("=")+1,c=e.substring(0,f)+'"'+e.substring(f)+'"',h.tagValue=c):h.tagValue=e,n.one(".machine-tags-section").getStyle("display")==="none"&&n.one(".machine-tags-section").setStyle("display","block"),s=l.templates("sub-photo-tags-tag")(h),t.prepend(s)):(h.tagValue=e.replace(/\s/g,""),s=l.templates("sub-photo-tags-tag")(h),u&&t.one("[data-autotag-content='"+e+"']").addClass("hidden"),t.one(".add-tag").insert(s,"after"))}),l.setupRollOverTagEvents()},setupRemoveTagEvents:function(){var t=this.get("container"),r=this.get("photoTags"),i=r.getValue("tags"),s=this.get("tagModel"),o=this.get("photoAutotags"),u=o.getValue("autotags"),a=this.get("autotagModel"),f={},l=t.one(".machine-tags-list"),c=this;this.registerEventHandler(t.all(".tags-list, .machine-tags-list").on("click",function(r){if(r.target.hasClass("remove-tag")||r.target.hasClass("delete-tag")||r.target.hasClass("remove-autotag")||r.target.hasClass("delete-autotag")||r.target.hasClass("remove-dual-tag")||r.target.hasClass("delete-dual-tag")){r.preventDefault();var o=r.target.ancestor(".tag",!0),h,p;o?(h=o.getAttribute("data-tag-id"),s.remoteDelete(h).then(function(){i.removeFromList(h,"id"),o.remove(!0),i.toJSON().length===0&&u.toJSON().length===0?(t.addClass("empty"),c.fire("subviewViewEvent","tagsTagView:tagsEmpty")):i.toJSON().length===0&&t.one(".add-tag").setStyle("display","none")},function(){c.onError(c.intlMessage({intlName:"photo-page-scrappy.ERROR_DELETING_TAG"}))}),r.target.hasClass("remove-dual-tag")||r.target.hasClass("delete-dual-tag")?(p=o.getAttribute("data-autotag-id"),f.photo_id=c.photoId,f.autotags=p,a.remoteDelete(f).then(function(){u.remove(p,"id")},function(){n.warn("deleting the corresponding autotag for this usertag failed")}),e.rapidTracker.beacon(c.name,"dualTagDeleteClick",{type:p})):e.rapidTracker.beacon(c.name,"tagDeleteClick")):(o=r.target.ancestor(".autotag",!0),p=o.getAttribute("data-autotag-id"),f.photo_id=c.photoId,f.autotags=p,a.remoteDelete(f).then(function(){u.remove(p,"id"),o.remove(!0),u.toJSON().length===0&&i.toJSON().length===0&&(t.one(".add-tag").setStyle("display","none"),t.addClass("empty"),c.fire("subviewViewEvent","tagsTagView:tagsEmpty"))},function(){c.onError(c.intlMessage({intlName:"photo-page-scrappy.ERROR_DELETING_TAG"}))}),e.rapidTracker.beacon(c.name,"autotagDeleteClick",{type:p})),l.getDOMNode().childElementCount||t.one(".machine-tags-section").setStyle("display","none"),t.one(".tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),t.one(".tags-list").all(".not-eol").removeClass("not-eol"),t.one(".machine-tags-section").getStyle("display")==="block"&&(t.one(".machine-tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),t.one(".machine-tags-list").all(".not-eol").removeClass("not-eol"))}}))},processTag:function(t){var n,r,i;i=t.replace(/"(.*?)"/g,function(e,t){return t=t.replace(/(,)/g,function(e,t){return t="{COMMA}",t}),t=t.replace(/(\s+)/g,function(e,t){return t="{WHITESPACE"+t.charCodeAt(0)+"}",t}),t}),i.indexOf(",")>-1?r=i.split(/,/):r=i.split(/\s+/);for(n in r)r[n]=r[n].replace(/\{WHITESPACE([0-9]+)\}/g,function(e,t){return t=String.fromCharCode(t),t}),r[n]=r[n].replace(/\{COMMA\}/g,function(e,t){return t=",",t});return e.Array.each(r,function(t,n){t=e.Lang.trim(t),r[n]=t}),r=e.Array.filter(r,function(e,t){if(e.length>0)return!0}),r},setupRollOverTagEvents:function(){var e=this.get("container"),t;this.registerEventHandler(e.all(".tags-list, .machine-tags-list").on("mouseover",function(e){t=e.target.ancestor(".tag, .autotag",!0);if(t&&t.hasClass("can-remove-tag")){var n=t.ancestor(".tags-list")?t.ancestor(".tags-list").getDOMNode().offsetLeft:t.ancestor(".machine-tags-list").getDOMNode().offsetLeft,i=t.getDOMNode().offsetLeft,s=t.ancestor(".tags-list")?parseInt(t.ancestor(".tags-list").getComputedStyle("width"),10):parseInt(t.ancestor(".machine-tags-list").getComputedStyle("width"),10),o=parseInt(t.getComputedStyle("width"),10);s-(i-n+o)<=r.tagHoverMaxWidth?(t.removeClass("not-eol"),t.addClass("end-of-the-line")):(t.removeClass("end-of-the-line"),t.addClass("not-eol"))}}))},showAutotagsHelper:function(t){var n=this.get("container"),r=n.one(".autotags-helper-icon"),i,s=this.templates("tags-helper-text");i=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,anchorOffsetHorizontal:12,width:240,observePageResize:!0,anchorElement:r,htmlMessage:s({})}),i.show()},onError:function(t){return this.errorDialog=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),message:t,darkOverlay:!0}),this.errorDialog.show(),this.errorDialog}})},"@VERSION@",{requires:["flickr-view","hermes-template-sub-photo-tags-tag-section","hermes-template-sub-photo-tags-tag","hermes-template-tags-helper-text","hermes-template-head-meta","url-helper"],optional:[],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-sub-photo-person-pro-badgeable",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=e.lambda,u=e.escapeExpression;return"data-"+u(o((s=t!=null?t.dataAttr:t)!=null?s.key:s,t))+'="'+u(o((s=t!=null?t.dataAttr:t)!=null?s.value:s,t))+'"'},3:function(e,t,n,r,i){var s;return e.escapeExpression(e.lambda((s=t!=null?t.buddyicon:t)!=null?s["default"]:s,t))},5:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n.buddyicon||(t!=null?t.buddyicon:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"buddyicon",hash:{},data:i}):s))},7:function(e,t,n,r,i){return'<a href="/account/upgrade/pro" class="pro-badge-inline">PRO</a>'},9:function(e,t,n,r,i){return'		<a class="remove-person hide-text ui-icon-comment-delete" href="#">x</a>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'<li class="person" '+((s=n["if"].call(u,t!=null?t.dataAttr:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+'>\n	<div class="person-icon">\n		<a class="'+l((o=(o=n.extraClasses||(t!=null?t.extraClasses:t))!=null?o:a,typeof o===f?o.call(u,{name:"extraClasses",hash:{},data:i}):o))+'" href="/photos/'+l((o=(o=n.pathAlias||(t!=null?t.pathAlias:t))!=null?o:a,typeof o===f?o.call(u,{name:"pathAlias",hash:{},data:i}):o))+'/" data-track="'+l((o=(o=n.dataTrackPrefix||(t!=null?t.dataTrackPrefix:t))!=null?o:a,typeof o===f?o.call(u,{name:"dataTrackPrefix",hash:{},data:i}):o))+'PersonIconClick">\n			<div class="circle-icon" data-person-nsid="'+l((o=(o=n.nsid||(t!=null?t.nsid:t))!=null?o:a,typeof o===f?o.call(u,{name:"nsid",hash:{},data:i}):o))+'">\n				<img class="show-person-menu" src="'+((s=n["if"].call(u,(s=t!=null?t.buddyicon:t)!=null?s["default"]:s,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.program(5,i,0),data:i}))!=null?s:"")+'" width="32" height="32">\n			</div>\n			<span class="person-name">'+l((o=(o=n.displayname||(t!=null?t.displayname:t))!=null?o:a,typeof o===f?o.call(u,{name:"displayname",hash:{},data:i}):o))+"</span>"+((s=n["if"].call(u,t!=null?t.isPro:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n		</a>\n"+((s=n["if"].call(u,t!=null?t.showRemove:t,{name:"if",hash:{},fn:e.program(9,i,0),inverse:e.noop,data:i}))!=null?s:"")+"	</div>\n</li>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/sub-photo-person-pro-badgeable",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-sub-photo-person",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=e.lambda,u=e.escapeExpression;return"data-"+u(o((s=t!=null?t.dataAttr:t)!=null?s.key:s,t))+'="'+u(o((s=t!=null?t.dataAttr:t)!=null?s.value:s,t))+'"'},3:function(e,t,n,r,i){var s;return e.escapeExpression(e.lambda((s=t!=null?t.buddyicon:t)!=null?s["default"]:s,t))},5:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n.buddyicon||(t!=null?t.buddyicon:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"buddyicon",hash:{},data:i}):s))},7:function(e,t,n,r,i){return'		<a class="remove-person hide-text ui-icon-comment-delete" href="#">x</a>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'<li class="person" '+((s=n["if"].call(u,t!=null?t.dataAttr:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+'>\n	<div class="person-icon">\n		<a class="'+l((o=(o=n.extraClasses||(t!=null?t.extraClasses:t))!=null?o:a,typeof o===f?o.call(u,{name:"extraClasses",hash:{},data:i}):o))+'" href="/photos/'+l((o=(o=n.pathAlias||(t!=null?t.pathAlias:t))!=null?o:a,typeof o===f?o.call(u,{name:"pathAlias",hash:{},data:i}):o))+'/" data-track="'+l((o=(o=n.dataTrackPrefix||(t!=null?t.dataTrackPrefix:t))!=null?o:a,typeof o===f?o.call(u,{name:"dataTrackPrefix",hash:{},data:i}):o))+'PersonIconClick">\n			<div class="circle-icon" data-person-nsid="'+l((o=(o=n.nsid||(t!=null?t.nsid:t))!=null?o:a,typeof o===f?o.call(u,{name:"nsid",hash:{},data:i}):o))+'">\n				<img class="show-person-menu" src="'+((s=n["if"].call(u,(s=t!=null?t.buddyicon:t)!=null?s["default"]:s,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.program(5,i,0),data:i}))!=null?s:"")+'" width="32" height="32">\n			</div>\n			<span class="person-name">\n				'+l((o=(o=n.displayname||(t!=null?t.displayname:t))!=null?o:a,typeof o===f?o.call(u,{name:"displayname",hash:{},data:i}):o))+"\n			</span>\n		</a>\n"+((s=n["if"].call(u,t!=null?t.showRemove:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))!=null?s:"")+"	</div>\n</li>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/sub-photo-person",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-invite-person",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=e.lambda,u=e.escapeExpression;return"data-"+u(o((s=t!=null?t.dataAttr:t)!=null?s.key:s,t))+'="'+u(o((s=t!=null?t.dataAttr:t)!=null?s.value:s,t))+'"'},3:function(e,t,n,r,i){return'		<a class="remove-person hide-text ui-icon-comment-delete" href="#">x</a>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'<li class="person" '+((s=n["if"].call(u,t!=null?t.dataAttr:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+'>\n	<div class="person-icon">\n		<div class="circle-icon">\n			<img src="https://s.yimg.com/pw/images/icon_unread.gif" width="'+l((o=(o=n.size||(t!=null?t.size:t))!=null?o:a,typeof o===f?o.call(u,{name:"size",hash:{},data:i}):o))+'" height="'+l((o=(o=n.size||(t!=null?t.size:t))!=null?o:a,typeof o===f?o.call(u,{name:"size",hash:{},data:i}):o))+'">\n		</div>\n		<p class="person-name">\n		'+l((o=(o=n.email||(t!=null?t.email:t))!=null?o:a,typeof o===f?o.call(u,{name:"email",hash:{},data:i}):o))+"\n		</p>\n"+((s=n["if"].call(u,t!=null?t.showRemove:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+"	</div>\n</li>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/invite-person",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-creatr-footer",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){return'<!-- creatr footer -->\n\n<div class="pure-g creatr-footer-wrapper">\n\n	<div class="pure-u-1-5">\n	</div>\n\n	<div class="pure-u-3-5">\n\n		<div class="legalese">\n\n			<a href="/ATOS/Create/" target="_blank">terms</a> | <a href="https://info.yahoo.com/privacy/us/yahoo/flickr/details.html" target="_blank">privacy</a> | <a href="https://help.yahoo.com/kb/index?page=content&y=PROD_FLICKR&locale=en_US&id=SLN22232" target="_blank">help</a>\n\n		</div>\n\n	</div>\n\n	<div class="pure-u-1-5">\n	</div>\n\n</div>\n'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/creatr-footer",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-sub-photo-tags-people-section",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return'    <a href="#" class="show-add-people">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_PEOPLE"},data:i}))+"</a>\n"},3:function(e,t,n,r,i){return'<input type ="text" class="add-person" placeholder="'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_PERSON"},data:i}))+'">\n'},5:function(e,t,n,r,i){var s;return"\n"+((s=n.each.call(t!=null?t:{},t!=null?t.people:t,{name:"each",hash:{},fn:e.program(6,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"},6:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.person:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:""},7:function(e,t,n,r,i){var s;return(s=e.invokePartial(r["sub-photo-person-pro-badgeable"],t!=null?t.person:t,{name:"sub-photo-person-pro-badgeable",data:i,indent:"			",helpers:n,partials:r,decorators:e.decorators}))!=null?s:""},9:function(e,t,n,r,i){var s;return(s=e.invokePartial(r["invite-person"],t!=null?t.invite:t,{name:"invite-person",data:i,indent:"			",helpers:n,partials:r,decorators:e.decorators}))!=null?s:""},11:function(e,t,n,r,i){var s;return"\n"+((s=n.each.call(t!=null?t:{},t!=null?t.people:t,{name:"each",hash:{},fn:e.program(12,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"},12:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.person:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:""},13:function(e,t,n,r,i){var s;return(s=e.invokePartial(r["sub-photo-person"],t!=null?t.person:t,{name:"sub-photo-person",data:i,indent:"			",helpers:n,partials:r,decorators:e.decorators}))!=null?s:""},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing;return"<h3>"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PEOPLE_IN_PHOTO"},data:i}))+"</h3>\n\n"+((s=n["if"].call(o,t!=null?t.canAddMeta:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"+((s=n["if"].call(o,t!=null?t.canAddMeta:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'\n<div class="person-list">\n\n'+((s=(n.isFlipped||t&&t.isFlipped||u).call(o,"enable-pro-badge",{name:"isFlipped",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"+((s=(n.isNotFlipped||t&&t.isNotFlipped||u).call(o,"enable-pro-badge",{name:"isNotFlipped",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i}))!=null?s:"")+'\n</div>\n\n<div style="clear:both;"></div>'},usePartial:!0,useData:!0}),r={};e.Array.each(["sub-photo-person-pro-badgeable","invite-person","sub-photo-person","invite-person"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/sub-photo-tags-people-section",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-sub-photo-person-pro-badgeable","hermes-template-invite-person","hermes-template-sub-photo-person","hermes-template-invite-person"]});
YUI.add("sub-photo-tags-people-view",function(e,t){var n=require("lib/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.photoId=t.photoId,this.context=e.clone(t.context,!0),this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this._css={locked:"ui-util-locked",working:"ui-util-working",removed:"ui-util-removed",shim:"c-contact-search-shim"},this},loadState:function(){var t=this,n=new e.FlickrPromise({photo:this.appContext.getModel("photo-models",this.photoId),photoPeople:this.appContext.getModel("photo-people-models",this.photoId),peopleModel:this.appContext.getModelRegistry("person-in-photo-models"),person:this.appContext.getModelRegistry("person-models")});return n.then(function(e){t.set("photo",e.photo),t.set("photoPeople",e.photoPeople),t.set("peopleModel",e.peopleModel),t.set("person",e.person)}).then(function(){var e=t.appContext.getViewer();if(e.signedIn)return t.get("person").get(e.nsid).then(function(e){t.set("me",e)})})},buildContainer:function(){var e=this.get("photo"),t=this.get("photoPeople"),n=t.getValue("people"),r=e.getValue("isOwner")||e.getValue("canAddMeta"),i,s=e.getValue("isOwner"),o=this,u=!1;return n&&(i=n.toJSON(),i.length===0&&r&&(u=!0,this.get("container").addClass("empty"),this.fire("subviewViewEvent","tagsPeopleView:peopleEmpty")),i.forEach(function(e){e.person?(e.person.size=32,e.person.showRemove=o.canRemoveTag(s,o.appContext.getViewer().nsid,e.addedBy,e.person.nsid),e.person.dataAttr={key:"person-nsid",value:e.person.nsid}):(e.invite={size:32,email:e.email},e.invite.showRemove=o.canRemoveTag(s,o.appContext.getViewer().nsid,e.addedBy,null),e.invite.dataAttr={key:"person-tag-email",value:e.invite.email})}),i=i.sort(function(e,t){return e.invite&&t.person?-1:e.person&&t.invite?1:e.person&&t.person&&e.person.displayname.toUpperCase()<t.person.displayname.toUpperCase()?-1:e.person&&t.person&&e.person.displayname.toUpperCase()>t.person.displayname.toUpperCase()?1:e.invite&&t.invite&&e.invite.email&&t.invite.email&&e.invite.email.toUpperCase()<t.invite.email.toUpperCase()?-1:e.invite&&t.invite&&e.invite.email&&t.invite.email&&e.invite.email.toUpperCase()>t.invite.email.toUpperCase()?1:0})),r||i.length>0?this.setContainerWithTemplate("sub-photo-tags-people-section",{people:i,canAddMeta:r,emptyPeopleTags:u}):this.setContainerHTML(""),this},focusTag:function(){var e=this.get("container"),t=e.one(".add-person");t&&t.focus()},activate:function(){var t=this.get("container"),n=t.one(".add-person"),r="",i=this.get("photoPeople")?this.get("photoPeople").getValue("people"):null,s=[],o=this,u=this.appContext.getViewer().prefs.keyboardShortcutsEnabled;return t.one(".show-add-people")&&(this.registerEventHandler(t.one(".show-add-people").on("click",function(e){e.preventDefault(),t.hasClass("empty")&&(t.removeClass("empty"),o.fire("subviewViewEvent","tagsPeopleView:peopleNotEmpty")),t.one(".c-contact-search-autocomplete").setStyle("display","block"),t.one(".add-person").setStyle("display","block"),t.one(".add-person").focus()})),u&&this.attachKeyEvent("down:80",function(e){e.preventDefault();try{t.hasClass("empty")&&(t.removeClass("empty"),o.fire("subviewViewEvent","tagsPeopleView:peopleNotEmpty")),t.one(".c-contact-search-autocomplete").setStyle("display","block"),t.one(".add-person").setStyle("display","block"),t.one(".add-person").focus()}catch(n){}})),this.focus&&(setTimeout(function(){n.focus()},100),this.focus=!1),n&&(i&&(s=i.getList()),this.arrow=e.Node.create('<span class="ui-dialog-arrow contact-autocomplete-arrow"></span>'),this.contacts=new e.ContactSearchBox({el:n,appContext:this.appContext,shim:this._css.shim,elValue:"value",signedOut:!1,canTag:1,noShim:!0,searchNonContacts:!0,loadMoreOnScroll:!0,upInitially:!1,alwaysDownward:!0,loadingState:this.templates(e.Balls())(),max:1e3,hideInitially:s.map(function(e){return e.id}),me:this.get("me"),onError:function(){n.blur(),o.contacts.hide(),o.fire("subviewViewEvent","getDialogOffset",function(t){var n=new e.Views.FluidModal({appContext:o.appContext,title:o.intlMessage({intlName:"common.ERROR"}),message:o.intlMessage({intlName:"photo-page-scrappy.CONTACT_LIST_ERROR"}),actionButtonLabel:o.intlMessage({intlName:"common.OK"}),showCancelButton:!1,classList:"scrappy-dialog"});n.show()})},onShow:function(r){var i=n.ancestor(".c-contact-search-autocomplete");o.arrow||(o.arrow=e.Node.create('<span class="ui-dialog-arrow contact-autocomplete-arrow"></span>')),o.arrow.inDoc()||i.appendChild(o.arrow),o.arrow.removeClass("hide"),t.addClass(o._css.locked),o.fire("subviewViewEvent","make in view",t)},onSelect:function(e){e?t.removeClass(o._css.locked):t.addClass(o._css.locked)},onHide:function(){var e=n;o.arrow.addClass("hide"),e.setHTML(r),o.fire("subviewViewEvent","close in view")},onOrientationChange:function(e){o.arrow&&(e?o.arrow.addClass("upside-down"):o.arrow.removeClass("upside-down"))},clickContact:function(t,i){var s,u,a,f,l,c,h;if(e.UA.ie&&document.getSelection()){c=document.getSelection().anchorNode;if(c.id==="content")return}n.removeClass("focused"),n.setHTML(r),o.contacts.abort=!0,o.hideDropdown=setTimeout(function(){o.contacts.hide()},150),i?s=i.ancestor("[data-nsid]",!0):s=t.target.ancestor("[data-nsid]",!0);if(!s){o.contacts.hide();return}u=s.getData("nsid"),f=s.one("img").get("src"),a=s.getData("displayname")||"",l=s.getData("path-alias"),h=s.getData("ispro")||!1,o.addTemporaryPersonTag(a,u,f,l,h),o.addRemotePersonTag(u),o.contacts.hideFromSearch(u),o.contacts.hide(),o.contacts.abort=!0,o.get("container").one(".add-person").set("value",""),o.get("container").one(".add-person").focus()}}),this.registerEventHandler(n.on("focus",function(t){var n=this;t.preventDefault(),this.addClass("focused"),o.contacts.abort=!1,setTimeout(function(){e.UA.ie&&(n.addClass("focused"),n.focus()),n.set("text","")},40)})),this.registerEventHandler(n.on("keydown",function(e){e.keyCode===13&&(e.halt(),clearTimeout(o.hideDropdown),n.focus())})),this
.registerEventHandler(n.on("blur",function(e){this.removeClass("focused")})),this.registerEventHandler(n.ancestor(".c-contact-search-autocomplete").on("focus",function(e){e.target.hasClass("c-contact-search-autocomplete")&&(clearTimeout(o.hideDropdown),n.focus())}))),t.one(".person-list")&&this.registerEventHandler(t.one(".person-list").on("click",function(e){e.target.hasClass("remove-person")?o.removeTag(e):e.target.ancestor("[data-loading]")&&e.preventDefault()})),this},removeTag:function(e){e.preventDefault();var t=e.target.ancestor("[data-person-nsid]"),r=e.target.ancestor("[data-person-tag-email]"),i=this.get("photoPeople").getValue("people"),s,o;t?(s=t.getData("person-nsid"),t.setAttribute("data-loading",s),i.removeFromList(s,"id"),this.remoteRemoveTag(s),this.contacts.showInSearch(s)):r?(o=r.getData("person-tag-email"),r.setAttribute("data-loading",o),i.removeFromList(o,"email"),this.remoteRemoveTag(null,o)):n.warn("tried to remove invalid person tag.")},remoteRemoveTag:function(e,t){var n=this.get("container"),r=n.one(".person-list"),i=e?"userId":"email",s=e||t,o=this,u={photoId:this.photoId,coords:{x:0,y:0,w:0,h:0}};u[i]=s,this.get("peopleModel").remoteDelete(u).then(function(){var i=e?r.one('[data-person-nsid="'+e+'"]'):r.one('[data-person-tag-email="'+t+'"]');i&&i.remove(!0),r.one("li")||(n.one(".c-contact-search-autocomplete").setStyle("display","none"),n.addClass("empty"),o.fire("subviewViewEvent","tagsPeopleView:peopleEmpty"))},function(e){o.onError(o.intlMessage({intlName:"photo-page-scrappy.FAILED_TO_REMOVE_PERSON"}))})},addTemporaryPersonTag:function(e,t,n,r,i){this.addPerson({dataAttr:{key:"loading",value:t},buddyicon:n,size:50,displayname:e,isPro:this.appContext.flipper.isFlipped("enable-pro-badge")&&i,pathAlias:r||t,nsid:t,showRemove:!0})},addPerson:function(e){var t=this.get("container"),n=t.one(".person-list"),r,i;this.appContext.flipper.isFlipped("enable-pro-badge")?i="sub-photo-person-pro-badgeable":i="sub-photo-person",r=this.templates(i)(e),n.prepend(r)},addRemotePersonTag:function(e){var t=this.get("container"),n=t.one(".person-list"),r=this,i=this.get("photoPeople")?this.get("photoPeople").getValue("people"):null;this.get("peopleModel").remoteCreate({photoId:this.photoId,userId:e,addedBy:r.get("me").getValue("nsid"),coords:{x:0,y:0,w:0,h:0}}).then(function(t){var s,o,u=n.one('[data-loading="'+e+'"]');u&&(u.removeAttribute("data-loading"),u.setAttribute("data-person-nsid",e)),s=r.get("peopleModel"),o=s.add(t),i&&i.appendToList(o)},function(){var t=n.one('[data-loading="'+e+'"]');t.remove(!0),r.onError(r.intlMessage({intlName:"photo-page-scrappy.PERSON_CANNOT_BE_TAGGED"}))})},canRemoveTag:function(e,t,n,r){return e||t&&n===t||r&&r===t},onError:function(t){var n=this,r;r=new e.Views.FluidModal({appContext:this.appContext,title:n.intlMessage({intlName:"common.ERROR"}),message:t,actionButtonLabel:n.intlMessage({intlName:"common.OK"}),showCancelButton:!1}),r.show()}})},"@VERSION@",{requires:["flickr-view","hermes-template-sub-photo-person-pro-badgeable","hermes-template-sub-photo-person","hermes-template-invite-person","hermes-template-creatr-footer","hermes-template-sub-photo-tags-people-section","url-helper","contact-search-box","html5-balls"],langBundles:["common","photo-page-scrappy"]});
