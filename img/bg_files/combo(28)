YUI.add("hermes-template-fave",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return"is-faved"},3:function(e,t,n,r,i){return"can-not-fave"},5:function(e,t,n,r,i){var s;return e.escapeExpression((n.formatNumber||t&&t.formatNumber||n.helperMissing).call(t!=null?t:{},(s=t!=null?t.photo:t)!=null?s.faveCount:s,{name:"formatNumber",hash:{},data:i}))},7:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},(s=t!=null?t.photo:t)!=null?s.faveCount:s,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.noop,data:i}))!=null?s:""},8:function(e,t,n,r,i){var s;return e.escapeExpression((n.friendlyNumber||t&&t.friendlyNumber||n.helperMissing).call(t!=null?t:{},(s=t!=null?t.photo:t)!=null?s.faveCount:s,{name:"friendlyNumber",hash:{},data:i}))},10:function(e,t,n,r,i){var s;return'		    <a href="#" title="'+((s=n["if"].call(t!=null?t:{},t!=null?t.loadingView:t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.program(13,i,0),data:i}))!=null?s:"")+'" data-action="fave"></a>\n'},11:function(e,t,n,r,i){return e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"fave-view.LOADING_FAVES"},data:i}))},13:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},(s=t!=null?t.photo:t)!=null?s.isFaved:s,{name:"if",hash:{},fn:e.program(14,i,0),inverse:e.program(16,i,0),data:i}))!=null?s:""},14:function(e,t,n,r,i){return e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"fave-view.UNFAVE_PHOTO"},data:i}))},16:function(e,t,n,r,i){return e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"fave-view.FAVE_PHOTO"},data:i}))},18:function(e,t,n,r,i){return'		    <a href="#" title="'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"fave-view.WHO_FAVED"},data:i}))+'" data-action="showfaves"></a>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return'<div class="button">\n	<span class="fave-star '+((s=n["if"].call(o,(s=t!=null?t.photo:t)!=null?s.isFaved:s,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n.unless.call(o,(s=t!=null?t.photo:t)!=null?s.canFave:s,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n		<svg class="icon icon-fave"><use xlink:href="#icon-fave"></use></svg>\n		<svg class="icon icon-fave_hollow"><use xlink:href="#icon-fave_hollow"></use></svg>\n	</span>\n	<span class="fave-count" unselectable="on">'+((s=n["if"].call(o,t!=null?t.realFullscreen:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.program(7,i,0),data:i}))!=null?s:"")+'</span>\n\n	<div class="button-overlay">\n'+((s=n["if"].call(o,(s=t!=null?t.photo:t)!=null?s.canFave:s,{name:"if",hash:{},fn:e.program(10,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,(s=t!=null?t.photo:t)!=null?s.faveCount:s,{name:"if",hash:{},fn:e.program(18,i,0),inverse:e.noop,data:i}))!=null?s:"")+"	</div>\n</div>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fave",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("fave-view",function(e,t){var n=require("lib/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.offNetworkFave=e.offNetworkFave||!1,this.hideWhoFaved=e.hideWhoFaved||!1,this.get("container").get("innerHTML")===""&&this.setContainerWithTemplate("fave",{photo:{canFave:!1},loadingView:!0}),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),this.realFullscreen=!!e.realFullscreen,this},buildContainer:function(){var e=this.get("photo-engagement");return this.setContainerWithTemplate("fave",{photo:e.toJSON(),realFullscreen:this.realFullscreen}),this},loadState:function(){var t=this,n=this.appContext.getViewer(),r=[];return r.push(this.appContext.getModel("photo-engagement-models",this.photoId).then(function(e){t.set("photo-engagement",e)})),n.signedIn&&r.push(this.appContext.getModelRegistry("favorite-models").then(function(e){t.set("favoriteModelRegistry",e)})),n.signedIn&&t.appContext.getModel("person-models",n.nsid).then(function(e){t.set("viewer-person-model",e)}),e.Promise.all(r)},activate:function(){var t=this.get("photo-engagement"),r=this,i,s=this.appContext.getViewer().prefs.keyboardShortcutsEnabled,o,u=this.appContext.getViewer().nsid,a=this.get("container").one(".fave-star");return t&&this.registerEventHandler(t.on("valuesChanged",function(i){var s,f=typeof i.faveCount!="undefined"||typeof i.isFaved!="undefined"||typeof i.canFave!="undefined";if(!f)return;a.addClass("is-transitioning"),setTimeout(function(){i&&i.isFaved&&i.isFaved.newVal?a.addClass("is-faved"):a.removeClass("is-faved")},225),setTimeout(function(){a.removeClass("is-transitioning")},300);var l=r.get("favoriteModelRegistry");l&&l.exists&&l.exists(u)&&(o=l.proxy(u).getValue("photoPageList"),i.isFaved&&i.isFaved.newVal?r.appContext.getModel("photo-models",i.isFaved.id).then(function(e){o.unshift(e)}):o.remove(i.isFaved.id)),s=t.remoteUpdate(),s.then(function(){r.processingFave=!1},function(n){n.code!==3&&(n.code!==5&&e.Object.each(i,function(e,n){t.setValue(n,e.prevVal)}),r.fire("subviewViewEvent","getDialogOffset",function(t){var n=new e.Views.FluidModal({appContext:this.appContext,title:r.intlMessage({intlName:"common.ERROR"}),message:r.intlMessage({intlName:"fave-view.COULDNT_FAVE"}),actionButtonLabel:r.intlMessage({intlName:"common.OK"}),showCancelButton:!1,classList:"scrappy-dialog"});n.show()})),r.processingFave=!1}).then(null,function(e){r.processingFave=!1,n.error({err:e})})},r.photoId)),i={":fave":r.faveStarClicked},this.attachEvents(i),s&&r.attachKeyEvent("down:70",r.faveStarClicked.bind(r)),this},showSignUpAndFaveModal:function(t){var n=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),r=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"}),i;i=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:n,signUpMessage:r,beaconPrefix:"fave"}),i.on("signUpClick",function(n){e.SigninHelper.signUpPendingFave({id:t})}),i.on("signInClick",function(n){e.SigninHelper.addPendingFave({id:t})}),i.show()},faveStarClicked:function(t,n){var r=this,i=this.get("photo-engagement"),s=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_MESSAGE"}),o=this.intlMessage({intlName:"fave-view.SIGN_IN_AND_FAVE"}),u=this.intlMessage({intlName:"common.CANCEL"}),a;t.preventDefault();if(this.processingFave)return;e.rapidTracker.beacon(this.name,"faveButtonClick"),this.processingFave=!0,this.bringIntoFocus();if(!this.appContext.getViewer().signedIn){if(this.offNetworkFave){e.SigninHelper.addPendingFave({id:this.photoId},{withPopup:!0,closeWhenDone:!0}),this.processingFave=!1;return}if(this.signedOutTest)return this.processingFave=!1,this.showSignUpAndFaveModal(this.photoId);a=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),htmlMessage:s,actionButtonLabel:o,cancelButtonLabel:u}),a.on("actionClick",function(){e.rapidTracker.beacon(r.name,"faveModalSigninClick"),e.SigninHelper.addPendingFave({id:r.photoId})}),a.on("cancelClick",function(t){e.rapidTracker.beacon(r.name,"faveModalCancelClick")}),a.show(),this.processingFave=!1}else i.getValue("canFave")&&(i.registry.toggleFave(this.photoId),e.rapidTracker.beacon(this.name,"faveStarActionBarButtonClick"))}})},"@VERSION@",{requires:["flickr-view","hermes-template-fave","fluid-modal-view","signin-helper","hermes-template-fave-menu","hermes-template-person","animation-manager"],optional:["photo-engagement-models","photo-people-who-faved-models","person-models","favorite-models"],langBundles:["fave-view","common"]});
YUI.add("hermes-template-dialog-cta-reboot",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return'		<h1 class="ui-dialog-title">'+e.escapeExpression(e.lambda((s=t!=null?t.attrs:t)!=null?s.title:s,t))+"</h1>\n"},3:function(e,t,n,r,i){var s;return'		<div class="ui-dialog-icon">\n			<i class="ui-icon-big-'+e.escapeExpression(e.lambda((s=t!=null?t.attrs:t)!=null?s.icon:s,t))+'"></i>\n		</div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return'<div class="ui-dialog-wrapper ui-dialog ui-dialog-cta ui-dialog-cta-reboot">\n'+((s=n["if"].call(o,(s=t!=null?t.attrs:t)!=null?s.title:s,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,(s=t!=null?t.attrs:t)!=null?s.icon:s,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'\n	<div class="ui-dialog-body">\n		'+e.escapeExpression((n.dialogOutlet||t&&t.dialogOutlet||n.helperMissing).call(o,t!=null?t.content:t,{name:"dialogOutlet",hash:{},data:i}))+"\n	</div>\n</div>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/dialog-cta-reboot",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-scrappy-edit-button",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return'	<div class=\'edit\'>\n		<a href="#" title="'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.EDIT_PHOTO"},data:i}))+'" class="button">\n			<i class="ui-icon-edit"></i>\n		</a>\n	</div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.viewerIsOwner:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:""},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/scrappy-edit-button",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-scrappy-edit-menu",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=t!=null?t:{};return((s=n["if"].call(o,t!=null?t.enableEditInAviary:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(4,i,0),data:i}))!=null?s:"")+"			"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(o,{name:"intlMessage",hash:{intlName:"aviary.EDIT_IN_AVIARY"},data:i}))+"\n			</a></li>\n"},2:function(e,t,n,r,i){return'			<li><a href="#" class="edit-aviary">\n'},4:function(e,t,n,r,i){var s,o=t!=null?t:{};return'			<li><a href="#" class="unavailable-feature '+((s=n["if"].call(o,t!=null?t.isVideo:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" '+((s=n["if"].call(o,t!=null?t.isVideo:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))!=null?s:"")+">\n"},5:function(e,t,n,r,i){return"isVideo"},7:function(e,t,n,r,i){return'title="'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.NO_VIDEOS_IN_AVIARY"},data:i}))+'"}}"'},9:function(e,t,n,r,i){var s,o=t!=null?t:{};return'		<li><a href="#" class="rotate-photo '+((s=n["if"].call(o,t!=null?t.isVideo:t,{name:"if",hash:{},fn:e.program(10,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" '+((s=n["if"].call(o,t!=null?t.isVideo:t,{name:"if",hash:{},fn:e.program(12,i,0),inverse:e.noop,data:i}))!=null?s:"")+">\n			"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ROTATE"},data:i}))+"\n		</a></li>\n"},10:function(e,t,n,r,i){return"isVideo unavailable-feature"},12:function(e,t,n,r,i){return'title="'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.NO_VIDEO_ROTATION"},data:i}))+'"'},14:function(e,t,n,r,i){var s,o=t!=null?t:{};return'		<li><a href="#" class="replace-photo '+((s=n["if"].call(o,t!=null?t.isVideo:t,{name:"if",hash:{},fn:e.program(10,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" '+((s=n["if"].call(o,t!=null?t.isVideo:t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")+">\n			"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.REPLACE"},data:i}))+"\n		</a></li>\n"},15:function(e,t,n,r,i){return'title="'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.NO_VIDEO_REPLACE"},data:i}))+'"'},17:function(e,t,n,r,i){return'		<li><a href="#" class="delete-photo">\n			'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.DELETE"},data:i}))+"\n		</a></li>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return"<ul>\n\n"+((s=n["if"].call(o,t!=null?t.showEditInAviaryLink:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"+((s=n["if"].call(o,t!=null?t.showRotateLink:t,{name:"if",hash:{},fn:e.program(9,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"+((s=n["if"].call(o,t!=null?t.showReplaceLink:t,{name:"if",hash:{},fn:e.program(14,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n\n"+((s=n["if"].call(o,t!=null?t.showDeleteLink:t,{name:"if",hash:{},fn:e.program(17,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n</ul>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/scrappy-edit-menu",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-replace-photo-dialog-content",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return'<div class="ui-dialog-wrapper c-dialog-cta-photoreplace">\n	<button class="ui-button ui-dialog-button-close" data-action="dismiss"><span>&nbsp;</span></button>\n	<div class="ui-dialog-description js-description">\n		'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ERROR_REPLACING_PHOTO"},data:i}))+'\n	</div>\n	<div class="ui-buttonbar ui-dialog-buttonbar"></div>\n</div>\n'},3:function(e,t,n,r,i){var s,o=t!=null?t:{};return'<div class="ui-dialog-wrapper c-dialog-cta-photoreplace">\n	<div class="ui-dialog-title">\n		<h3>'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.REPLACE_PHOTO"},data:i}))+'</h3>\n		<i data-action="dismiss" class="cancel-confirmation ui-dialog-button-close"></i>\n	</div>\n	<div class="dialog-content">\n		<i class="dialog-icon ui-icon-modal-warning"></i>\n		<div class="ui-dialog-description js-description">\n'+((s=n["if"].call(o,t!=null?t.fileName:t,{name:"if",hash:{},fn:e.program(4,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'		</div>\n	</div>\n	<div class="ui-buttonbar ui-dialog-buttonbar">\n'+((s=n["if"].call(o,t!=null?t.fileName:t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.program(14,i,0),data:i}))!=null?s:"")+"\n	</div>\n</div>\n"},4:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.uploading:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.program(7,i,0),data:i}))!=null?s:""},5:function(e,t,n,r,i){return"					"+e.escapeExpression((n.intlHTMLMessage||t&&t.intlHTMLMessage||n.helperMissing).call(t!=null?t:{},{name:"intlHTMLMessage",hash:{fileName:t!=null?t.fileName:t,intlName:"photo-page-scrappy.REPLACE_UPLOADING"},data:i}))+'\n					<progress min="0" max="100" value="0"></progress>\n'},7:function(e,t,n,r,i){return"					"+e.escapeExpression((n.intlHTMLMessage||t&&t.intlHTMLMessage||n.helperMissing).call(t!=null?t:{},{name:"intlHTMLMessage",hash:{fileName:t!=null?t.fileName:t,username:t!=null?t.username:t,photoTitle:t!=null?t.photoTitle:t,intlName:"photo-page-scrappy.PERMANENTLY_REPLACE"},data:i}))+"\n"},9:function(e,t,n,r,i){return"				"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.REPLACE_WARNING"},data:i}))+"\n"},11:function(e,t,n,r,i){var s;return(s=n.unless.call(t!=null?t:{},t!=null?t.uploading:t,{name:"unless",hash:{},fn:e.program(12,i,0),inverse:e.noop,data:i}))!=null?s:""},12:function(e,t,n,r,i){return'				<button class="ui-button ui-button-cta c-button-replace ui-dialog-button-done" data-action="submit">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.REPLACE"},data:i}))+"</button>\n"},14:function(e,t,n,r,i){return'			<input type="file" name="file" accept="image/*">\n			<button class="ui-button ui-button-cta c-button-changefile ui-dialog-button-done" data-action="change">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.CHOOSE_FILE"},data:i}))+"</button>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.error:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:""},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/replace-photo-dialog-content",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-rotate-photo-dialog-content",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return'<div class="ui-dialog-wrapper c-dialog-cta-photorotate">\n	<div class="ui-dialog-description js-description">\n		'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ERROR_ROTATING_PHOTO"},data:i}))+'\n	</div>\n	<div class="ui-buttonbar ui-dialog-buttonbar"></div>\n</div>\n'},3:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression,f=e.lambda;return'<div class="ui-dialog-wrapper c-dialog-cta-photorotate">\n	<div class="ui-dialog-description js-description">\n\n		<h3>'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ROTATE_PHOTO"},data:i}))+'</h3>\n\n		<ul class="c-rotations '+((s=(n.ifCond||t&&t.ifCond||u).call(o,(s=t!=null?t.preview:t)!=null?s.width:s,"<",(s=t!=null?t.preview:t)!=null?s.height:s,{name:"ifCond",hash:{},fn:e.program(4,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n			<li><img class="ui-util-rotate-90" src="'+a(f((s=t!=null?t.preview:t)!=null?s.url:s,t))+'" data-action="select" data-rotation="90"></li>\n			<li><img class="ui-util-rotate-180" src="'+a(f((s=t!=null?t.preview:t)!=null?s.url:s,t))+'" data-action="select" data-rotation="180"></li>\n			<li><img class="ui-util-rotate-270" src="'+a(f((s=t!=null?t.preview:t)!=null?s.url:s,t))+'" data-action="select" data-rotation="270"></li>\n		</ul>\n\n	</div>\n	<div class="ui-buttonbar ui-dialog-buttonbar">\n		<button class="ui-button ui-button-cta c-button-rotate ui-dialog-button-done" data-action="submit">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ROTATE_PHOTO"},data:i}))+"</button>\n	</div>\n</div>\n"},4:function(e,t,n,r,i){return"c-rotations-portrait"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.error:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:""},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/rotate-photo-dialog-content",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-well-scrappy-edit-view",function(e,t){var n=require("lib/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.backToURL=e.backToURL,this.context=e.context,this.get("container").get("innerHTML")===""&&this.setContainerWithTemplate("scrappy-edit-button",{loadingView:!0}),this.aviaryParams={nsid:this.nsid,photoId:this.photoId,backToURL:this.backToURL},this},loadState:function(){var t=this;return this.appContext.getViewer().signedIn?this.appContext.getModel("photo-models",t.photoId).then(function(n){t.set("photo",n);if(n.getValue("owner").getValue("isMe")&&!t.appContext.forceServerRender)return t.appContext.getModel(t.context.modelName,t.context.params).then(function(e){t.set("contextModel",e)}).then(function(){var n=e.merge(t.context.params,{photoId:t.photoId,numNext:1,numPrev:1});return t.get("contextModel").getValue("photoContextList").getContext(n).then(function(){var e,n=t.get("contextModel").getValue("photoContextList").getList(),r=n.length;e=n.map(function(e){return e.getValue("id")}).indexOf(t.photoId),e>=0&&e<r&&t.set("nextPhotoModel",n[e+1]),e>0&&t.set("prevPhotoModel",n[e-1])})})}):e.Promise.resolve()},buildContainer:function(){var e=this.get("photo").getValue("owner").getValue("isMe");return this.setContainerWithTemplate("scrappy-edit-button",{viewerIsOwner:e}),this},activate:function(){var e=this,t=this.get("container");return t&&this.registerEventHandler(t.on("click",e.handleMenuButtonClick,e)),this},setupDropdown:function(t){var n=this.get("container"),r=this.get("photo"),i,s=r.getValue("owner").getValue("isMe"),o,u=!1,a=!1,f=this,l=r.getValue("isVideo"),c=r.getValue("id");this.appContext.flipper.isFlipped("turn-off-aviary")&&(a=!0),s&&(u=!0),i=e.URLHelper.getPhotoPage({photoId:r.getValue("id"),pathAlias:r.getValue("owner").getValue("pathAlias")}),o=this.templates("scrappy-edit-menu")({photoURL:i,photoId:c,viewerIsOwner:s,showDeleteLink:s,showRotateLink:s&&!l,showReplaceLink:s&&!l,isVideo:l,showEditInAviaryLink:s&&!l&&!a,enableEditInAviary:u}),this.editMenu&&(this.editMenu.close(),this.editMenu=null),this.editMenu=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,preferTop:!0,showDropArrow:!0,anchorOffsetHorizontal:3,anchorElement:n.one(".edit"),htmlMessage:o,closeOnScroll:!1,classList:"dialog-tooltip",hideModalOverlay:!0}),this.editMenu.on("activated",function(r){f.fire("subviewViewEvent","make in view",n),e.use("feather-aviary-view",function(){t()})}),this.editMenu.on("closeDroparound",function(e){f.fire("subviewViewEvent","close in view")}),this.editMenu.show()},handleMenuButtonClick:function(t){var n=this;t.preventDefault(),e.rapidTracker.beacon(this.name,"editMenuClick"),this.appContext.experiments.fullscreen.getMode()||this.setupDropdown(function(){var e={},t=n.editMenu.get("container");n.appContext.auth.signedIn&&(e.deleteMenuItem=t.one(".delete-photo"),e.deleteMenuItem&&e.deleteMenuItem.on("click",n.handleDeletePhotoClick,n),e.rotateMenuItem=t.one(".rotate-photo"),e.rotateMenuItem&&e.rotateMenuItem.on("click",n.handleRotatePhotoClick,n),e.replaceMenuItem=t.one(".replace-photo"),e.replaceMenuItem&&e.replaceMenuItem.on("click",n.handleReplacePhotoClick,n),e.aviaryMenuItem=t.one(".edit-aviary"),e.aviaryMenuItem&&e.aviaryMenuItem.on("click",n.handleEditAviaryClick,n))})},handleDeletePhotoClick:function(t){t.preventDefault();var n;this.editMenu.close(),n=new e.Views.FluidModal({title:this.intlMessage({intlName:"photo-page-scrappy.DELETE_PHOTO"}),actionButtonLabel:this.intlMessage({intlName:"common.DELETE"}),htmlMessage:this.intlMessage({intlName:"photo-page-scrappy.PERMANTENTLY_DELETE"}),appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!0,classList:"scrappy-dialog",actionButtonDisabled:!1,showCancelButton:!0,hideModalOverlay:!1,showCancelX:!0}),n.on("actionClick",this.handleDeletePhotoConfirmClick.bind(this)),n.show(),e.rapidTracker.beacon(this.name,"deletePhotoClick")},handleDeletePhotoConfirmClick:function(t){var n=this,r=n.get("photo").getValue("owner"),i,s=n.get("nextPhotoModel"),o=n.get("prevPhotoModel");e.rapidTracker.beacon(this.name,"deletePhotoConfirmationClick"),n.deleteDialog&&n.deleteDialog.close(),this.appContext.callAPI("flickr.photos.delete",{photo_id:this.photoId}).then(function(t){s?i=e.URLHelper.getPhotoPage({photoId:s.getValue("id"),pathAlias:s.getValue("owner").getValue("pathAlias"),contextSuffix:n.get("contextModel").getValue("urlSuffix")}):o?i=e.URLHelper.getPhotoPage({photoId:o.getValue("id"),pathAlias:o.getValue("owner").getValue("pathAlias"),contextSuffix:n.get("contextModel").getValue("urlSuffix")}):i=r.getValue("url")+"?deleted="+n.photoId,e.config.win.location=i},function(e){n.showErrorDialog(n.intlMessage({intlName:"photo-page-scrappy.ERROR_DELETING_PHOTO"}))})},handleReplacePhotoClick:function(t){t.halt();var n=this,r=this.get("photo").getValue("isVideo");if(r)return;this.editMenu.close(),this.replaceDialog=new e.Views.FluidModal({appContext:this.appContext,htmlMessage:this.templates("replace-photo-dialog-content")(),classList:"scrappy-dialog dialog-modal",showCancelX:!1,showHeader:!1,showFooter:!1,width:700}),this.replaceDialog.attachEvents({"input change:":function(e){e.halt();var t=e.target.getDOMNode().files[0];if(!t)return;n._imgFile=t,n.replaceConfirm()},":submit":function(){n.replaceSubmit()}}),this.replaceDialog.on("close",function(){n._imgFileXhr&&n._imgFileXhr.abort(),n._imgFileXhr=null,n._imgFile=null,this.replaceDialog=null}),this.replaceDialog.show(),e.rapidTracker.beacon(this.name,"replacePhotoClick")},replaceConfirm:function(){this.replaceDialog.set("htmlMessage",this.templates("replace-photo-dialog-content")({fileName:this._imgFile.name})),this.replaceDialog.buildContainer(),this.replaceDialog.activate(),e.rapidTracker.beacon(this.name,"replacePhotoConfirmationClick")},replaceSubmit:function(){var t=new FormData,r=this,i,s,o=e.config.flickr.api.hostname_client_replace
,u,a,f;t.append("api_key",e.config.flickr.api.site_key),t.append("csrf",e.config.flickr.csrf.token),t.append("photo",this._imgFile,this._imgFile.name),t.append("photo_id",this.photoId),i=this._imgFileXhr=new XMLHttpRequest,i.open("POST",o,!0),i.withCredentials=!0,a=function(e){var t=typeof e=="object"?e.target.statusText:e+"";r.replaceDialog.close(),r.showErrorDialog(r.intlMessage({intlName:"photo-page-scrappy.ERROR_REPLACING_PHOTO"})),n.error("error during upload",{statusText:t})},f=function(e){var t,n,i;try{i=document.createElement("div"),i.innerHTML=e.target.responseText,n=i.getElementsByTagName("rsp")[0]||"",n&&(n=n.getAttribute("stat")||""),t=i.getElementsByTagName("err")[0]||"",t&&(t=t.getAttribute("msg")||"")}catch(s){n="",t=""}if(n!=="ok")return a((n||"empty")+": "+(t||"no message"));r.replaceDialog.close(),window.location.reload()},this.replaceDialog.set("htmlMessage",this.templates("replace-photo-dialog-content")({fileName:this._imgFile.name,uploading:!0})),this.replaceDialog.buildContainer(),this.replaceDialog.activate(),u=this.replaceDialog.get("container").one("progress"),i.addEventListener("load",f),i.addEventListener("error",a),i.upload.addEventListener("progress",function(e){u.value=s=Math.floor(100*(e.loaded/e.total)),e.loaded===e.total&&u.removeAttribute("value")}),i.send(t)},handleRotatePhotoClick:function(t){t.halt();var n=this,r=240,i=this.get("photo").getValue("isVideo");if(i)return;this.editMenu.close(),this.rotateDialog=new e.Views.FluidModal({appContext:this.appContext,htmlMessage:this.templates("rotate-photo-dialog-content")({preview:n.get("photo").getSizeToFit({width:r,height:r})}),dismissOnOverlayClick:!0,showFooter:!1,showHeader:!1,showCancelX:!0,width:700,classList:"scrappy-dialog dialog-modal"}),this.rotateDialog.attachEvents({":select":function(t,r){t.target.ancestor(".c-rotations").all("img").removeClass("c-state-selected"),t.target.addClass("c-state-selected"),n._imgRotation=e.flutil.constrainToValues(r.rotation,["90","180","270"])},":submit":function(){n.rotateSubmit()}}),this.rotateDialog.on("close",function(){n.rotateDialog=null}),this.rotateDialog.show(),e.rapidTracker.beacon(this.name,"rotatePhotoClick")},rotateSubmit:function(){var t=this;t.rotateDialog.get("container").one(".ui-dialog-buttonbar").addClass("loading").append(t.templates("flickr-balls")({})),e.rapidTracker.beacon(this.name,"rotatePhotoConfirmationClick"),this.appContext.callAPI("flickr.photos.transform.rotate",{photo_id:this.photoId,degrees:this._imgRotation}).then(function(){setTimeout(function(){t.rotateDialog.close(),t.fire("subviewViewEvent","photo:reload")},2e3)},function(e){t.rotateDialog.get("container").one(".ui-dialog-buttonbar").removeClass("loading"),t.rotateDialog.close(),t.showErrorDialog(t.intlMessage({intlName:"photo-page-scrappy.ERROR_ROTATING_PHOTO"})),n.error("error during rotation",{statusText:e.toString()})})},handleEditAviaryClick:function(t){t.halt(),this.editMenu.close(),this.appContext.getView("feather-aviary-view",this.aviaryParams).then(function(e){return e.initialize().then(function(){e.activate()})}),e.rapidTracker.beacon(this.name,"editAviary")},showErrorDialog:function(t){return this.errorDialog=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),message:t,darkOverlay:!0}),this.errorDialog.show(),this.errorDialog}})},"@VERSION@",{requires:["flickr-view","flutil","hermes-template-dialog-cta-reboot","flickr-promise","fluid-modal-view","fluid-droparound-view","hermes-template-scrappy-edit-button","hermes-template-scrappy-edit-menu","hermes-template-replace-photo-dialog-content","hermes-template-rotate-photo-dialog-content","hermes-template-flickr-balls"],optional:[],langBundles:["common","photo-page-scrappy","aviary"]});
YUI.add("hermes-lang-aviary",function(e,t){e.Intl.add("hermes/aviary","en-US",{SAVE:["Save a new copy"],SAVE_PHOTO:["Save this photo"],ERROR:["An error has occurred using Aviary. Please try again."],ENHANCE:["Enhance"],IMAGE_TOO_LARGE:["Sorry, but this image is too large to be edited. Please try again with an image that is less than 50 megapixels."],NO_ORIGINAL_PHOTO:["Unable to get the original photo. Please try again."],RETRY_DIALOG_MESSAGE:["This is taking longer than usual. Would you like to retry saving your changes?"],EDIT_IN_AVIARY:["Edit in Aviary"],SELECT_PHOTO_TO_EDIT:["Select photo to Edit"],PREVIOUS_EDIT_WARNING:["This photo has previously been edited on a mobile device. Choose if you want to edit the current version, or its original. If you select the current version, you will no longer be able to undo the edits that you have made so far on your mobile device."],ORIGINAL_LABEL:["Original"],CURRENT_LABEL:["Current"],ORIGINAL_IMAGE:["Original image"],CURRENT_IMAGE:["Current image"],CROSS_PLATFORM_EDIT_WARNING:["This photo was last edited on a mobile device. If you choose to replace this photo, you will no longer be able to undo the edits that you have made so far on your mobile device."]})},"@VERSION@",{requires:["intl"]});
